{"pages":[{"title":"About","text":"","link":"/about/index.html"},{"title":"","text":"google-site-verification: google94a85560805a7e1e.html","link":"/google94a85560805a7e1e.html"}],"posts":[{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2019/03/hello-world/"},{"title":"Icarus ä¸»é¢˜è‡ªå®šä¹‰ï¼ˆåŸºäº2.xï¼‰","text":"æœ¬æ–‡æ˜¯åŸºäºicarus 2.xçš„ç‰ˆæœ¬ï¼Œicarusä»3.0å¼€å§‹ä½¿ç”¨jsxé‡å†™äº†ï¼ŒæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚ æœ¬åšå®¢æ‰€é€‰å–çš„ä¸»é¢˜æ˜¯ Icarus ï¼Œå¹¶åšäº†ä¸€äº›ä¸ªæ€§åŒ–çš„ä¿®æ”¹ï¼Œå¾ˆå¤šä¿®æ”¹éƒ½å¯ä»¥ç›´è§‚çš„çœ‹åˆ°ã€‚è¯¦ç»†çš„å·®å¼‚å¯ä»¥æŸ¥çœ‹ diffï¼Œè¿™é‡Œè®°å½•ä¸€äº›ä¸»è¦çš„æ”¹åŠ¨ã€‚ æ³¨: å¯ä»¥é€šè¿‡å˜é‡ page.layout æ¥åˆ¤æ–­å½“å‰é¡µé¢ç±»å‹ï¼Œ'post' è¡¨ç¤ºå½“å‰æ˜¯æ–‡ç« é¡µé¢ï¼Œå…·ä½“å¯å‚è€ƒ hexo æ–‡æ¡£ã€‚ å¸ƒå±€æ–‡ç« é¡µé¢ä¸¤æ å¸ƒå±€ä¸»é¢˜é»˜è®¤æ˜¯ä¸‰æ å¸ƒå±€ï¼Œå¹¶ä¸”æ˜¾ç¤ºäº†å¾ˆå¤šçš„ widget ï¼Œä½†åœ¨é˜…è¯»æ–‡ç« æ—¶æ˜¾å¾—æœ‰äº›æ‹¥æŒ¤ã€‚å› æ­¤åœ¨æ–‡ç« é¡µé¢ï¼Œä¿®æ”¹ä¸ºä¸¤æ å¸ƒå±€ï¼Œå¹¶æ˜¾ç¤ºç‰¹å®šçš„ widgetã€‚ diff:includes/helpers/layout.js12345678910 const widgets = hexo.extend.helper.get('get_config').bind(this)('widgets');- return widgets.filter(widget =&gt; widget.hasOwnProperty('position') &amp;&amp; widget.position === position);+ if (this.page.layout !== 'post') {+ return widgets.filter(widget =&gt; widget.hasOwnProperty('position') &amp;&amp; widget.position === position);+ }+ if (position === 'left') {+ return widgets.filter(widget =&gt; widget.hasOwnProperty('position') &amp;&amp; (widget.type === 'toc' || widget.type === 'profile'));+ } else {+ return []+ } å¯ä»¥å‚è€ƒä¸Šè¿°ä»£ç ï¼Œå³å¯å®ç°ä¸åŒé¡µé¢ä¸åŒ widgetã€‚ ä½†ä¸¤æ æ•´ä½“å®½åº¦è·Ÿä¸‰æ ä¸åŒã€‚å› æ­¤å¼ºåˆ¶æŒ‡å®šä¸ºä¸‰æ å¸ƒå±€ï¼Œå¹¶ä¸”ä¿®æ”¹ç›¸åº”çš„å®½åº¦ï¼Œè¿™æ ·æ‰€æœ‰çš„é¡µé¢ä¾§è¾¹æ å®½åº¦ä¿æŒä¸€è‡´ã€‚ diff:layout/common/widget.ejs123456 &lt;% function side_column_class() { switch (column_count()) { case 2:- return 'is-4-tablet is-4-desktop is-4-widescreen';+ return 'is-4-tablet is-4-desktop is-3-widescreen'; case 3: diff:layout/layout.ejs12345678910-&lt;body class=&quot;is-&lt;%= column_count() %&gt;-column&quot;&gt;+&lt;body class=&quot;is-3-column&quot;&gt; &lt;%- partial('common/navbar', { page }) %&gt; &lt;% function main_column_class() { switch (column_count()) { case 1: return 'is-12'; case 2:- return 'is-8-tablet is-8-desktop is-8-widescreen';+ return 'is-8-tablet is-8-desktop is-9-widescreen'; å¹¶ä¿®æ”¹åœ¨ä¸åŒå±å¹•å°å¤§ä¸‹çš„å®½åº¦ diff:source/css/style.styl12345678910111213 .is-2-column .container max-width: screen-desktop - 2 * gap width: screen-desktop - 2 * gap+ .is-3-column .container+ max-width: screen-widescreen - gap+ width: screen-widescreen - gap @media screen and (min-width: screen-fullhd)+ .is-3-column .container+ max-width: screen-fullhd - 2 * gap+ width: screen-fullhd - 2 * gap .is-2-column .container max-width: screen-widescreen - 2 * gap width: screen-widescreen - 2 * gap ä¼˜åŒ–æ–‡ç« æ ‡é¢˜å¸ƒå±€æ ‡é¢˜ç§»åŠ¨åˆ°æ–‡ç« ä¿¡æ¯ä¸Šæ–¹ï¼Œå¢åŠ æ›´æ–°æ—¶é—´ï¼Œå¹¶å¢åŠ äº†iconã€‚ diff:layout/common/article.ejs1234567891011121314151617 &lt;div class=&quot;card-content article &lt;%= post.hasOwnProperty('direction') ? post.direction : '' %&gt;&quot;&gt;+ &lt;h1 class=&quot;title is-size-3 is-size-4-mobile has-text-weight-normal&quot;&gt;+ &lt;% if (index) { %&gt;+ &lt;a class=&quot;has-link-black-ter&quot; href=&quot;&lt;%- url_for(post.link ? post.link : post.path) %&gt;&quot;&gt;&lt;i class=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;&lt;%= post.title %&gt;&lt;/a&gt;+ &lt;% } else { %&gt;+ &lt;i class=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;&lt;%= post.title %&gt;+ &lt;% } %&gt;+ &lt;/h1&gt; &lt;% if (post.layout != 'page') { %&gt; &lt;div class=&quot;level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto&quot;&gt; &lt;div class=&quot;level-left&quot;&gt;- &lt;time class=&quot;level-item has-text-grey&quot; datetime=&quot;&lt;%= date_xml(post.date) %&gt;&quot;&gt;&lt;%= date(post.date) %&gt;&lt;/time&gt;+ &lt;time class=&quot;level-item has-text-grey&quot; datetime=&quot;&lt;%= date_xml(post.date) %&gt;&quot;&gt;&lt;i class=&quot;far fa-calendar-alt&quot;&gt;&amp;nbsp;&lt;/i&gt;&lt;%= date(post.date) %&gt;&lt;/time&gt;+ &lt;% if (post.updated &amp;&amp; post.updated &gt; post.date) { %&gt;+ &lt;time class=&quot;level-item has-text-grey is-hidden-mobile&quot; datetime=&quot;&lt;%= date_xml(post.updated) %&gt;&quot;&gt;&lt;i class=&quot;far fa-calendar-check&quot;&gt;&amp;nbsp;&lt;/i&gt;&lt;%= date(post.updated) %&gt;&lt;/time&gt;+ &lt;% } %&gt; &lt;% if (post.categories &amp;&amp; post.categories.length) { %&gt; å…¶ä¸­åˆ›å»ºæ—¶é—´ä½¿ç”¨æ—¥æœŸã€‚ diff:source/js/main.js12345- if (typeof(moment) === 'function') {- $('.article-meta time').each(function () {- $(this).text(moment($(this).attr('datetime')).fromNow());- });- } ä¼˜åŒ–æ–‡ç« ç»“å°¾å¸ƒå±€åœ¨æ–‡ç« ç»“å°¾å¢åŠ ä¸€ä¸ª hrï¼Œå¹¶ä¿®æ”¹ tags å±•ç¤ºã€‚åœ¨é¢„è§ˆæ—¶ä¹Ÿæ˜¾ç¤º tagsï¼Œå¹¶ä¸”å°† Read More æŒ‰é’®æ”¾ç½®åœ¨å³è¾¹ã€‚ diff:layout/common/article.ejs123456789101112131415161718192021222324252627282930313233343536 &lt;% if (!index &amp;&amp; post.tags &amp;&amp; post.tags.length) { %&gt;+ &lt;hr style=&quot;height:1px;margin:1rem 0&quot;/&gt; &lt;div class=&quot;level is-size-7 is-uppercase&quot;&gt; &lt;div class=&quot;level-start&quot;&gt; &lt;div class=&quot;level-item&quot;&gt;- &lt;span class=&quot;is-size-6 has-text-grey has-mr-7&quot;&gt;#&lt;/span&gt;+ &lt;i class=&quot;fas fa-tags has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp; &lt;%- list_tags(post.tags, { class: 'has-link-grey ', show_count: false,- style: 'link'+ style: 'link',+ separator: ',&amp;nbsp;' }) %&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;% } %&gt; &lt;% if (index &amp;&amp; post.excerpt) { %&gt;- &lt;div class=&quot;level is-mobile&quot;&gt;+ &lt;hr style=&quot;height:1px;margin:1rem 0&quot;/&gt;+ &lt;div class=&quot;level is-mobile is-flex&quot;&gt;+ &lt;div class=&quot;level-start&quot;&gt;+ &lt;% if (post.tags &amp;&amp; post.tags.length) { %&gt;+ &lt;div class=&quot;level-item is-size-7 is-uppercase&quot;&gt;+ &lt;i class=&quot;fas fa-tags has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;+ &lt;%- list_tags(post.tags, {+ class: 'has-link-grey ',+ show_count: false,+ style: 'link',+ separator: ',&amp;nbsp;'+ }) %&gt;+ &lt;/div&gt;+ &lt;% } %&gt;+ &lt;/div&gt; &lt;div class=&quot;level-start&quot;&gt; ä¼˜åŒ–ä¸ªäººä¿¡æ¯å¸ƒå±€å‡å°‘å¤´åƒå¤§å°ï¼Œå¤´åƒä¸‹æ–¹è®¡æ•°çš„åœ°æ–¹å¢åŠ é“¾æ¥ï¼Œfollowå‰å¢åŠ iconã€‚ diff:layout/widget/profile.ejs1234567- &lt;nav class=&quot;level is-mobile&quot;&gt;+ &lt;nav class=&quot;level menu-list is-mobile&quot; style=&quot;margin-bottom:1rem&quot;&gt; &lt;div class=&quot;level-item has-text-centered is-marginless&quot;&gt;- &lt;div&gt;+ &lt;a href=&quot;&lt;%- url_for('/archives/') %&gt;&quot;&gt; &lt;p class=&quot;heading&quot;&gt;...... ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºåœ¨ç§»åŠ¨ç«¯ï¼Œéšè— archive å’Œ tagcloudã€‚ diff:layout/widget/archive.ejs12-&lt;div class=&quot;card widget&quot;&gt;+&lt;div class=&quot;card widget is-hidden-mobile&quot;&gt; diff:layout/widget/tagcloud.ejs12-&lt;div class=&quot;card widget&quot;&gt;+&lt;div class=&quot;card widget is-hidden-mobile&quot;&gt; ç›®å½•ç²˜æ€§å¸ƒå±€å¢åŠ  column-left is-sticky ç±»ã€‚ diff:layout/widget/toc.ejs12-&lt;div class=&quot;card widget&quot; id=&quot;toc&quot;&gt;+&lt;div class=&quot;card widget column-left is-sticky&quot; id=&quot;toc&quot;&gt; åŠŸèƒ½å¢åŠ ç‰ˆæƒè¯´æ˜diff:layout/common/article.ejs1234567891011121314 &lt;div class=&quot;content&quot;&gt; &lt;%- index &amp;&amp; post.excerpt ? post.excerpt : post.content %&gt; &lt;/div&gt;+ &lt;% if (!index &amp;&amp; post.layout === 'post' &amp;&amp; post.copyright !== false) { %&gt;+ &lt;ul class=&quot;post-copyright&quot;&gt;+ &lt;li&gt;&lt;strong&gt;æœ¬æ–‡æ ‡é¢˜ï¼š&lt;/strong&gt;&lt;a href=&quot;&lt;%= post.permalink %&gt;&quot;&gt;&lt;%= page.title %&gt;&lt;/a&gt;&lt;/li&gt;+ &lt;li&gt;&lt;strong&gt;æœ¬æ–‡ä½œè€…ï¼š&lt;/strong&gt;&lt;a href=&quot;&lt;%= theme.url %&gt;&quot;&gt;&lt;%= theme.author %&gt;&lt;/a&gt;&lt;/li&gt;+ &lt;li&gt;&lt;strong&gt;æœ¬æ–‡é“¾æ¥ï¼š&lt;/strong&gt;&lt;a href=&quot;&lt;%= post.permalink %&gt;&quot;&gt;&lt;%= post.permalink %&gt;&lt;/a&gt;&lt;/li&gt;+ &lt;li&gt;&lt;strong&gt;å‘å¸ƒæ—¶é—´ï¼š&lt;/strong&gt;&lt;%= post.date.format(&quot;YYYY-MM-DD&quot;) %&gt;&lt;/li&gt;+ &lt;li&gt;&lt;strong&gt;ç‰ˆæƒå£°æ˜ï¼š&lt;/strong&gt;æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ &lt;a href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&quot; rel=&quot;external nofollow&quot; target=&quot;_blank&quot;&gt;CC BY-NC-SA 4.0&lt;/a&gt; è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼+ &lt;/li&gt;+ &lt;/ul&gt;+ &lt;% } %&gt; &lt;% if (!index &amp;&amp; post.tags &amp;&amp; post.tags.length) { %&gt; å¹¶å¢åŠ æ ·å¼ diff:source/css/style.styl12345678+.post-copyright+ font-size: 1rem+ letter-spacing: 0.02rem+ word-break: break-all+ margin: 2.5rem 0 0+ padding: 1rem 1rem+ border-left: 3px solid #FF1700+ background-color: #F9F9F9 å¢åŠ æ ‡é¢˜è‡ªåŠ¨è®¡æ•°diff:source/css/style.styl1234567+.article {counter-reset:section}+.article h2{counter-reset:sub-section}+.article h3{counter-reset:composite}+.article h4{counter-reset:detail}+.article h2:before{content:counter(section) &quot; &quot;;counter-increment:section}+.article h3:before{content:counter(section) &quot;.&quot; counter(sub-section) &quot; &quot;;counter-increment:sub-section}+.article h4:before{content:counter(section) &quot;.&quot; counter(sub-section) &quot;.&quot; counter(composite) &quot; &quot;;counter-increment:composite} é»˜è®¤æ˜¾ç¤ºç›®å½•æ­£å¸¸å¼€å¯ç›®å½•éœ€è¦åœ¨ meta ä¿¡æ¯ä¸­åŠ å…¥ toc: true å¼€å¯ï¼Œä½†ç»å¤§éƒ¨åˆ†æ–‡ç« éƒ½æ˜¯æœ‰ç›®å½•çš„ï¼Œå› æ­¤ä¿®æ”¹ä¸ºé»˜è®¤å¼€å¯ã€‚å› ä¸ºæœ‰å¤šä¸ªåœ°æ–¹å¼•ç”¨äº† get_config('toc') å¹¶ä¸”éœ€è¦åˆ¤æ–­å½“å‰é¡µé¢ï¼Œæ”¹èµ·æ¥ç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œå› æ­¤ç›´æ¥ä¿®æ”¹äº† get_config æ–¹æ³•ã€‚ diff:includes/helpers/config.js1234567 return defaultValue; } else { const property = readProperty(specs, configName);- return property === null ? null : property[descriptors.defaultValue];+ const result = property === null ? null : property[descriptors.defaultValue];+ return (configName === 'toc' &amp;&amp; this.page.layout === 'post' &amp;&amp; result === null) ? true : result; } é¡µé¢footeræ˜¾ç¤ºä¸€ç»„iconé»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªiconå¯¹åº”ä¸€ä¸ªé“¾æ¥ï¼Œä½†ä¾‹å¦‚ CC BY-NC-SA 4.0 éœ€è¦å››ä¸ªå›¾æ ‡ä¸€ç»„ã€‚å› æ­¤ä¿®æ”¹ä»£ç ï¼Œä½¿å¾—é…ç½® link.icon å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•ˆæœå¯ä»¥å‚è€ƒé¡µé¢åº•éƒ¨ã€‚ diff:layout/common/footer.ejs1234 &lt;% } else { %&gt;- &lt;i class=&quot;&lt;%= link.icon %&gt;&quot;&gt;&lt;/i&gt;+ &lt;% for (let icon of (Array.isArray(link.icon) ? link.icon : [link.icon])) { %&gt;&lt;i class=&quot;&lt;%= icon %&gt;&quot;&gt;&lt;/i&gt;&amp;nbsp;&lt;% } %&gt; &lt;% } %&gt; diff:includes/specs/icon_link.spec.js12345 icon: { [required]: true,- [type]: 'string',+ [type]: ['string', 'array'], [doc]: 'Link icon class names' _config.yml ä¸­é…ç½®å¦‚ä¸‹ _config.yml123456789footer: links: CC BY-NC-SA 4.0: icon: - fab fa-creative-commons - fab fa-creative-commons-by - fab fa-creative-commons-nc - fab fa-creative-commons-sa url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/' å¯ä»¥é…ç½®æ–‡ç« å¼€å¤´æ˜¯å¦æ˜¾ç¤ºå›¾ç‰‡Icarus æ”¯æŒæ–‡ç« è®¾ç½®ä¸€ä¸ªå›¾ç‰‡ï¼Œåœ¨æ–‡ç« å¼€å¤´ã€æœ€è¿‘çš„æ–‡ç« ã€æ—¶é—´çº¿ç­‰åœ°æ–¹æ˜¾ç¤ºã€‚ä½†æœ‰äº›å›¾æ”¾å¤§ä¹‹åä¼šæ˜¾å¾—å¾ˆä¸åè°ƒï¼Œå› æ­¤ä¿®æ”¹ä»¥æ”¯æŒè‡ªå®šä¹‰æ˜¯å¦æ˜¾ç¤ºã€‚ä¿®æ”¹ has_thumbnail æ–¹æ³•ï¼Œå¢åŠ å‚æ•° isArticle å‚æ•°ï¼Œé»˜è®¤ falseï¼Œå¹¶åœ¨æ–‡ç« é¡µé¢ä¿®æ”¹è°ƒç”¨å‚æ•°ã€‚ diff:includes/helpers/page.js1234567891011- hexo.extend.helper.register('has_thumbnail', function (post) {+ hexo.extend.helper.register('has_thumbnail', function (post, isArticle = false) { const getConfig = hexo.extend.helper.get('get_config').bind(this); const allowThumbnail = getConfig('article.thumbnail', true); if (!allowThumbnail) { return false; }+ if (isArticle &amp;&amp; post['article-thumbnail'] === false){+ return false;+ } return post.hasOwnProperty('thumbnail') &amp;&amp; post.thumbnail; diff:layout/common/article.ejs1234 &lt;div class=&quot;card&quot;&gt;- &lt;% if (has_thumbnail(post)) { %&gt;+ &lt;% if (has_thumbnail(post, true)) { %&gt; &lt;div class=&quot;card-image&quot;&gt; è¿™æ ·ä¿®æ”¹ä¹‹åï¼Œå¦‚æœæ–‡ç«  meta ä¿¡æ¯ä¸­åŒ…å« article-thumbnail: falseï¼Œå°±å¯ä»¥å–æ¶ˆå›¾ç‰‡çš„æ˜¾ç¤ºã€‚ æ ·å¼ä¿®æ”¹ logo å’Œ faviconç”¨ Python è®¾è®¡ Logoï¼Œå¹¶å¾®è°ƒæ ·å¼ã€‚ æŒ‰é’®èƒŒæ™¯é¢œè‰²å¢åŠ æ¸å˜diff:source/css/style.styl123456 .menu-list li ul margin-right: 0+ .menu-list a+ transition: background-color 0.3s ease-in-out .menu-list a.level display: flex card å¢åŠ æµ®åŠ¨æ•ˆæœ:hover æ—¶å¢å¤§é˜´å½±ï¼Œå¹¶å¢åŠ åŠ¨ç”»å±æ€§ ease-in-outã€‚ diff:source/css/style.styl12345 .card border-radius: 4px box-shadow: 0 4px 10px rgba(0,0,0,0.05), 0 0 1px rgba(0,0,0,0.1)+ &amp;:hover+ box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1) diff:source/js/animation.js123 element.style.transform = '';- element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';+ element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out'; æ›´æ–°2020-02-16 åˆå¹¶äº† 2.7.0 ç‰ˆæœ¬ï¼Œå†²çªä¸ç®—å¤ªå¤šï¼Œæœ‰ä¸¤ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚ icarus çš„é…ç½®é‡Œé¢ï¼Œplugins.clipboard éœ€è¦ç§»é™¤ï¼Œç›¸å…³çš„é…ç½®ç§»åŠ¨åˆ° article.highlight.clipboardã€‚ _config.yml12345678910article: # Code highlight settings highlight: # Code highlight themes # https://github.com/highlightjs/highlight.js/tree/master/src/styles theme: github-gist # Show code copying button clipboard: true # Default folding status of the code blocks. Can be &quot;&quot;, &quot;folded&quot;, &quot;unfolded&quot; fold: unfolded å¦‚æœä¹‹å‰ links widget æ²¡æœ‰é…ç½®é“¾æ¥ï¼Œå¯èƒ½ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œéœ€è¦å¢åŠ ä¸€ä¸‹åˆ¤æ–­ã€‚ diff:layout/widget/links.locals.js12345 const links = get_config_from_obj(locals.widget, 'links');- if (Object.keys(links).length == 0) {+ if (!links || Object.keys(links).length == 0) { return null; } æ€»ç»“è¿™é‡Œåªåˆ—ä¸¾äº†éƒ¨åˆ†æ”¹åŠ¨ï¼Œè¯¦ç»†çš„å·®å¼‚å¯ä»¥æŸ¥çœ‹ diffã€‚ æœ¬æ–‡ä¼šæŒç»­æ›´æ–°ï¼Œä¿æŒè·Ÿæœ€æ–°çš„åšå®¢æ•ˆæœä¸€è‡´ï¼Œå¸Œæœ›èƒ½ç»™ä½ è‡ªå®šä¹‰ä¸»é¢˜ä¸€äº›å¸®åŠ©ã€‚ å¦‚æœæœ‰å…¶ä»–æƒ³æ³•æˆ–è€…æ„è§ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ã€‚ ğŸ˜Š","link":"/2019/03/customize-icarus-2/"},{"title":"Ubuntu å†…æ ¸å‡çº§","text":"Linux å†…æ ¸å¤§æ¦‚å‡ å¤©å°±ä¼šæœ‰ä¸€ä¸ªå°ç‰ˆæœ¬æ›´æ–°ï¼Œå‡ ä¸ªæœˆå°±ä¼šæœ‰ä¸€æ¬¡ä¸»è¦ç‰ˆæœ¬çš„æ›´æ–°ï¼Œä¾‹å¦‚ï¼š 2018-10-22 v4.19 2018-12-24 v4.20 2019-03-04 v5.0 2019-03-10 v5.0.1 2019-03-14 v5.0.2 2019-03-19 v5.0.3 ä¸ºäº†ä½¿ç”¨ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œæˆ–è€…ä¸ºäº†æå‡æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œæˆ–è€…åªæ˜¯ä¸ºäº†ä¿®å¤æŸäº›é—®é¢˜ï¼Œéœ€è¦å¯¹å†…æ ¸è¿›è¡Œå•ç‹¬å‡çº§ã€‚ The Linux Kernel ArchivesUbuntu Kernel Mainline å‡çº§å†…æ ¸æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†ä¸æ’é™¤å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œè¯·åˆç†è¯„ä¼°é£é™©ã€‚ æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬å¯ä»¥é€šè¿‡ uname æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œ 12$ uname -srLinux 4.4.0-92-generic æˆ–è€…è¾“å…¥ uname -a æŸ¥çœ‹å®Œæ•´ä¿¡æ¯ã€‚ Ubuntu å†…æ ¸å‡çº§æœ€å¥½æ˜¯å‡çº§åˆ°é•¿æœŸæ”¯æŒç‰ˆï¼ˆlongtermï¼‰æœ¬æˆ–è€…ç¨³å®šç‰ˆï¼ˆstableï¼‰ï¼Œå¯ä»¥åœ¨ The Linux Kernel ArchivesæŸ¥çœ‹å½“å‰çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥ longterm: 4.19.36 ä¸ºä¾‹ã€‚ ä¹‹ååœ¨ Ubuntu Kernel Mainline æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œhttps://kernel.ubuntu.com/~kernel-ppa/mainline/v4.19.36/ ã€‚ åœ¨å¯¹åº”çš„æ¶æ„Build for xxx succeededï¼Œä¸‹è½½ä¸åŒ…å« lowlatency çš„æ‰€æœ‰debæ–‡ä»¶ã€‚ä¾‹å¦‚åœ¨ x86_64 ä¸‹ï¼Œæ€»å…±éœ€è¦ä¸‹è½½4ä¸ªæ–‡ä»¶ã€‚ 1234linux-headers-4.19.36-041936_4.19.36-041936.201904200430_all.deblinux-headers-4.19.36-041936-generic_4.19.36-041936.201904200430_amd64.deblinux-image-unsigned-4.19.36-041936-generic_4.19.36-041936.201904200430_amd64.deblinux-modules-4.19.36-041936-generic_4.19.36-041936.201904200430_amd64.deb å®‰è£… 1sudo dpkg -i linux-*.deb é‡å¯ 1sudo reboot ç¡®è®¤å‡çº§æˆåŠŸ 12$ uname -srLinux 4.19.36-041936-generic è¿™é‡Œçœ‹åˆ°å†…æ ¸ç‰ˆæœ¬å·²ç»å‡çº§æˆåŠŸäº†ï¼Œå…¶ä»–ç‰ˆæœ¬æˆ–è€…æ¶æ„æ“ä½œä¹Ÿç±»ä¼¼ã€‚ åˆ é™¤æ—§çš„å†…æ ¸ç‰ˆæœ¬å¦‚æœç¡®å®è¦ç§»é™¤æ—§çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹å·²ç»å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼Œ 1dpkg --get-selections | grep linux ç„¶åç›´æ¥ä½¿ç”¨ apt-get purge åˆ é™¤æ—§ç‰ˆæœ¬çš„åŒ…ï¼ˆæœ‰æ˜ç¡®çš„ç‰ˆæœ¬å·ï¼‰ã€‚ æ€»ç»“è¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚ç›´æ¥ç”¨ apt-get å‡çº§ï¼Œè¿˜æœ‰ä¸€äº›å·¥å…·ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ How to update kernel to the latest mainline version without any Distro-upgrade?","link":"/2019/04/kernel-update/"},{"title":"ç”¨ Python è®¾è®¡ Logo","text":"ç”¨ Python è®¾è®¡ä¸€ä¸ªç®€å•çš„ logo ã€‚ é¢„è§ˆlogo.svg favicon.svg ä»£ç ä»£ç åªä¾èµ– matplotlibã€‚ 12345678910111213141516171819202122232425262728293031import matplotlib.pyplot as pltlines = [[[1, 4], [5, 8.08]], [[1, 4], [5, 1.92]], [[5, 9], [2.96, 7.04]], [[5, 6.5], [7.04, 5.5]], [[8, 9], [4, 2.96]]]color = '#00a4ef'linewidth = 28# favicon.svgplt.figure(figsize=(4, 4))plt.axis('off')plt.axis([0, 10, 0, 10])for l in lines: plt.plot(l[0], l[1], color, linewidth=linewidth)plt.savefig('favicon.svg')# logo.svgplt.figure(figsize=(10, 4))plt.axis('off')plt.axis([0, 25, 0, 10])for l in lines: plt.plot(l[0], l[1], color, linewidth=linewidth)plt.text(11, 2, 'Lxy', fontsize=180)plt.savefig('logo.svg') SVG å‹ç¼©å‹ç¼©SVGå¯ä»¥å‡å°‘å›¾ç‰‡å¤§å°ï¼Œå°è¯•äº†å‡ ä¸ªåœ¨çº¿å‹ç¼©svgçš„ç½‘ç«™ï¼Œæ•ˆæœéƒ½ä¸å¤ªç†æƒ³ï¼Œä¸»è¦æ˜¯å½¢çŠ¶å¤„ç†ä¸å‡†ç¡®ï¼Œè·ŸåŸå›¾æ˜¾ç¤ºä¸ä¸€æ ·ã€‚åæ¥è¯•äº† https://vecta.io/nano æ•ˆæœéå¸¸å¥½è€Œä¸”å‹ç¼©ç‡ä¹Ÿä¸é”™ï¼Œä¸Šè¿°ä¸¤å¼ å›¾ç‰‡å‹ç¼©ç‡è¶…è¿‡ 60% ã€‚ æ›¿æ¢æœ¬åšå®¢ä½¿ç”¨çš„æ˜¯ icarus ä¸»é¢˜ï¼Œåœ¨ themes/icarus/source/img ç›®å½•ä¸‹æ›¿æ¢ favicon.svg å’Œ logo.svg å³å¯ï¼Œå…¶ä»–ä¸»é¢˜æ“ä½œä¹Ÿç±»ä¼¼ã€‚","link":"/2019/03/python-logo/"},{"title":"Icarus ä¸»é¢˜è‡ªå®šä¹‰","text":"æœ¬æ–‡æ˜¯åŸºäºicarus 4.xçš„ç‰ˆæœ¬ï¼Œicarusåœ¨2.0ä½¿ç”¨çš„æ˜¯ejsï¼Œå¦‚æœéœ€è¦è¯·æŸ¥çœ‹æ—§ç‰ˆæœ¬ã€‚ æœ¬åšå®¢æ‰€é€‰å–çš„ä¸»é¢˜æ˜¯ Icarus ï¼Œå¹¶åšäº†ä¸€äº›ä¸ªæ€§åŒ–çš„ä¿®æ”¹ï¼Œå¾ˆå¤šä¿®æ”¹éƒ½å¯ä»¥ç›´è§‚çš„çœ‹åˆ°ã€‚è¯¦ç»†çš„å·®å¼‚å¯ä»¥æŸ¥çœ‹ diffï¼Œè¿™é‡Œè®°å½•ä¸€äº›ä¸»è¦çš„æ”¹åŠ¨ã€‚ å¸ƒå±€æ–‡ç« é¡µé¢ä¸¤æ å¸ƒå±€ä¸»é¢˜é»˜è®¤æ˜¯ä¸‰æ å¸ƒå±€ï¼Œåœ¨é˜…è¯»æ–‡ç« æ—¶æ˜¾å¾—æœ‰äº›æ‹¥æŒ¤ã€‚å¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼æŠŠæ‰€æœ‰æ–‡ç« å˜ä¸ºä¸¤æ å¸ƒå±€ï¼Œåœ¨_config.post.ymlæŠŠéœ€è¦çš„widgetæ˜¾ç¤ºåœ¨ä¸€è¾¹å³å¯ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ ä½†ä¸¤æ æ•´ä½“å®½åº¦è·Ÿä¸‰æ ä¸åŒï¼Œå› æ­¤å¼ºåˆ¶æŒ‡å®šä¸ºä¸‰æ å¸ƒå±€ï¼Œå¹¶ä¸”ä¿®æ”¹ç›¸åº”çš„å®½åº¦ï¼Œè¿™æ ·æ‰€æœ‰çš„é¡µé¢ä¾§è¾¹æ å®½åº¦ä¿æŒä¸€è‡´ã€‚ diff:layout/layout.jsx1234 &lt;Head site={site} config={config} helper={helper} page={page} /&gt;- &lt;body class={`is-${columnCount}-column`}&gt;+ &lt;body class={`is-3-column`}&gt; &lt;Navbar config={config} helper={helper} page={page} /&gt; diff:layout/layout.jsx1234 'is-12': columnCount === 1,- 'is-8-tablet is-8-desktop is-8-widescreen': columnCount === 2,+ 'is-8-tablet is-8-desktop is-9-widescreen': columnCount === 2, 'is-8-tablet is-8-desktop is-6-widescreen': columnCount === 3 diff:layout/common/widgets.jsx12345678 function getColumnSizeClass(columnCount) { switch (columnCount) { case 2:- return 'is-4-tablet is-4-desktop is-4-widescreen';+ return 'is-4-tablet is-4-desktop is-3-widescreen'; case 3: return 'is-4-tablet is-4-desktop is-3-widescreen'; } å¹¶ä¼˜åŒ–åœ¨ä¸åŒå±å¹•å°å¤§ä¸‹çš„å®½åº¦ diff:include/style/responsive.styl1234567891011121314151617 +widescreen()+ .is-3-column .container+ max-width: $widescreen - $gap+ width: $widescreen - $gap+ .is-1-column .container, .is-2-column .container max-width: $desktop - 2 * $gap width: $desktop - 2 * $gap +fullhd()+ .is-3-column .container+ max-width: $fullhd - 2 * $gap+ width: $fullhd - 2 * $gap+ .is-2-column .container max-width: $widescreen - 2 * $gap width: $widescreen - 2 * $gap ä¼˜åŒ–æ–‡ç« æ ‡é¢˜å¸ƒå±€æ ‡é¢˜ç§»åŠ¨åˆ°æ–‡ç« ä¿¡æ¯ä¸Šæ–¹ï¼Œå¢åŠ æ›´æ–°æ—¶é—´ï¼Œå¹¶å¢åŠ äº†icon diff:layout/common/article.jsx123456789101112131415161718192021222324252627282930313233 &lt;article class={`card-content article${'direction' in page ? ' ' + page.direction : ''}`} role=&quot;article&quot;&gt; {/* Metadata */}+ {/* Title */}+ &lt;h1 className=&quot;title is-size-3 is-size-4-mobile has-text-weight-normal&quot;&gt;+ {index ?+ &lt;a className=&quot;has-link-black-ter&quot; href={url_for(page.link || page.path)}&gt;+ &lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;{page.title}+ &lt;/a&gt; :+ [&lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;, page.title]+ }+ &lt;/h1&gt; {page.layout !== 'page' ? &lt;div class=&quot;article-meta is-size-7 is-uppercase level is-mobile&quot;&gt; &lt;div class=&quot;level-left&quot;&gt; {/* Creation Date */}- {page.date &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML={{- __html: _p('article.created_at', `&lt;time dateTime=&quot;${date_xml(page.date)}&quot; title=&quot;${new Date(page.date).toLocaleString()}&quot;&gt;${date(page.date)}&lt;/time&gt;`)- }}&gt;&lt;/span&gt;}+ {page.date &amp;&amp; &lt;span class=&quot;level-item&quot;&gt;+ &lt;i className=&quot;far fa-calendar-alt&quot;&gt;&amp;nbsp;&lt;/i&gt;+ &lt;time dateTime={date_xml(page.date)} title={date_xml(page.date)}&gt;{date(page.date)}&lt;/time&gt;+ &lt;/span&gt;} {/* Last Update Date */}- {page.updated &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML={{- __html: _p('article.updated_at', `&lt;time dateTime=&quot;${date_xml(page.updated)}&quot; title=&quot;${new Date(page.updated).toLocaleString()}&quot;&gt;${date(page.updated)}&lt;/time&gt;`)- }}&gt;&lt;/span&gt;}+ {shouldShowUpdated &amp;&amp; &lt;span class=&quot;level-item is-hidden-mobile&quot;&gt;+ &lt;i class=&quot;far fa-calendar-check&quot;&gt;&amp;nbsp;&lt;/i&gt;+ &lt;time dateTime={date_xml(page.updated)} title={date_xml(page.updated)}&gt;{date(page.updated)}&lt;/time&gt;+ &lt;/span&gt;} {/* author */} {page.author ? &lt;span class=&quot;level-item&quot;&gt; {page.author} &lt;/span&gt; : null} å…¶ä¸­æ—¶é—´ç›´æ¥ä½¿ç”¨æ—¥æœŸ diff:source/js/main.js12345- if (typeof moment === 'function') {- $('.article-meta time').each(function() {- $(this).text(moment($(this).attr('datetime')).fromNow());- });- } ä¼˜åŒ–æ–‡ç« ç»“å°¾å¸ƒå±€åœ¨æ–‡ç« ç»“å°¾å¢åŠ ä¸€ä¸ª hrï¼Œå¹¶ä¿®æ”¹ tags å±•ç¤ºã€‚åœ¨é¢„è§ˆæ—¶ï¼ˆä¸»é¡µï¼‰ä¹Ÿæ˜¾ç¤º tagsï¼Œå¹¶ä¸”å°† Read More æŒ‰é’®æ”¾ç½®åœ¨å³è¾¹ã€‚ diff:layout/common/article.jsx123456789101112131415161718192021 {/* Licensing block */} {!index &amp;&amp; article &amp;&amp; article.licenses &amp;&amp; Object.keys(article.licenses) ? &lt;ArticleLicensing.Cacheable page={page} config={config} helper={helper} /&gt; : null}+ &lt;hr style=&quot;height:1px;margin:1rem 0&quot;/&gt;+ &lt;div className=&quot;level is-mobile is-flex&quot;&gt; {/* Tags */}- {!index &amp;&amp; page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 mb-4&quot;&gt;- &lt;span class=&quot;mr-2&quot;&gt;#&lt;/span&gt;- {page.tags.map(tag =&gt; {- return &lt;a class=&quot;link-muted mr-2&quot; rel=&quot;tag&quot; href={url_for(tag.path)}&gt;{tag.name}&lt;/a&gt;;+ {page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 is-uppercase&quot;&gt;+ &lt;i class=&quot;fas fa-tags has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;+ {page.tags.map((tag, index) =&gt; {+ return &lt;a class=&quot;link-muted&quot; rel=&quot;tag&quot; href={url_for(tag.path)}&gt;{tag.name}{index !== page.tags.length-1? ', ':''}&lt;/a&gt;; })} &lt;/div&gt; : null} {/* &quot;Read more&quot; button */}- {index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href={`${url_for(page.link || page.path)}#more`}&gt;{__('article.more')}&lt;/a&gt; : null}+ {index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href={`${url_for(page.link || page.path)}#more`}&gt;&lt;i class=&quot;fas fa-book-reader has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;{__('article.more')}&lt;/a&gt; : null}+ &lt;/div&gt; {/* Share button */} ä¼˜åŒ–ä¸ªäººä¿¡æ¯å¸ƒå±€å‡å°‘å¤´åƒå¤§å°ï¼Œå¤´åƒä¸‹æ–¹è®¡æ•°çš„åœ°æ–¹å¢åŠ é“¾æ¥ï¼Œfollowå‰å¢åŠ iconã€‚ diff:layout/widget/profile.jsx123456789101112- &lt;div class=&quot;level-item has-text-centered is-marginless&quot;&gt;+ &lt;a class=&quot;level-item has-text-centered is-marginless&quot; href={counter.category.url}&gt; &lt;div&gt; &lt;p class=&quot;heading&quot;&gt;{counter.category.title}&lt;/p&gt;- &lt;a href={counter.category.url}&gt;+ &lt;div&gt; &lt;p class=&quot;title&quot;&gt;{counter.category.count}&lt;/p&gt;- &lt;/a&gt;+ &lt;/div&gt; &lt;/div&gt;- &lt;/div&gt;+ &lt;/a&gt; ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºåœ¨ç§»åŠ¨ç«¯ï¼Œéšè— archive å’Œ tagsã€‚ diff:source/js/main.js12345 }++ $('div.container div.card[data-type=tags]').addClass('is-hidden-mobile');+ $('div.container div.card[data-type=archives]').addClass('is-hidden-mobile'); }(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings)); ç›®å½•ç²˜æ€§å®šä½åŸæ¥åªæ”¯æŒä¾§è¾¹æ æ•´ä½“ç²˜æ€§å®šä½ï¼Œä¸ºäº†é˜…è¯»ä½“éªŒï¼Œåªé’ˆå¯¹ç›®å½•å¼€å¯ç²˜æ€§å®šä½ï¼Œå¢åŠ  column-left is-sticky ç±»ï¼Œå¹¶è°ƒæ•´æ ·å¼ã€‚ diff:source/js/main.js123 if ($toc.length &gt; 0) {+ $toc.addClass('column-left is-sticky'); const $mask = $('&lt;div&gt;'); diff:include/style/widget.styl123+#toc+ max-height: calc(100vh - 22px)+ overflow-y: scroll åŠŸèƒ½å¢åŠ é»˜è®¤ç¼©ç•¥å›¾diff:layout/layout.jsx12345 const { site, config, page, helper, body } = this.props;+ site.posts &amp;&amp; site.posts.filter(p =&gt; !p.thumbnail).forEach(p =&gt; p.thumbnail = '/img/thumbnail.svg');+ const language = page.lang || page.language || config.language; diff:layout/archive.jsx12345 const { url_for, __, date_xml, date } = helper;+ page.posts &amp;&amp; page.posts.filter(p =&gt; !p.thumbnail).forEach(p =&gt; p.thumbnail = '/img/thumbnail.svg');+ const language = page.lang || page.language || config.language; å¢åŠ è®¸å¯åè®®æ–°ç‰ˆå·²ç»æ”¯æŒè®¸å¯åè®®ï¼Œç›´æ¥é…ç½®å³å¯ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ å¢åŠ æ ‡é¢˜è‡ªåŠ¨è®¡æ•°diff:include/style/article.styl1234567+.article {counter-reset:section}+.article h2{counter-reset:sub-section}+.article h3{counter-reset:composite}+.article h4{counter-reset:detail}+.article h2:before{content:counter(section) &quot; &quot;;counter-increment:section}+.article h3:before{content:counter(section) &quot;.&quot; counter(sub-section) &quot; &quot;;counter-increment:sub-section}+.article h4:before{content:counter(section) &quot;.&quot; counter(sub-section) &quot;.&quot; counter(composite) &quot; &quot;;counter-increment:composite} é»˜è®¤æ˜¾ç¤ºç›®å½•æ–°ç‰ˆæ”¯æŒç›´æ¥é…ç½®ï¼Œåœ¨_config.ymlå¢åŠ toc: trueå³å¯ã€‚ é¡µé¢footeræ˜¾ç¤ºä¸€ç»„iconé»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªiconå¯¹åº”ä¸€ä¸ªé“¾æ¥ï¼Œä½†ä¾‹å¦‚ CC BY-NC-SA 4.0 éœ€è¦å››ä¸ªå›¾æ ‡ä¸€ç»„ã€‚å› æ­¤ä¿®æ”¹ä»£ç ï¼Œä½¿å¾—é…ç½® link.icon å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•ˆæœå¯ä»¥å‚è€ƒé¡µé¢åº•éƒ¨ã€‚ diff:layout/common/footer.jsx123456789101112 const link = links[name]; return &lt;p class=&quot;control&quot;&gt; &lt;a class={`button is-transparent ${link.icon ? 'is-large' : ''}`} target=&quot;_blank&quot; rel=&quot;noopener&quot; title={name} href={link.url}&gt;- {link.icon ? &lt;i class={link.icon}&gt;&lt;/i&gt; : name}+ {link.icon ?+ (Array.isArray(link.icon) ?+ link.icon.map(i =&gt; [&lt;i className={i}&gt;&lt;/i&gt;, '\\u00A0']) :+ &lt;i className={link.icon}&gt;&lt;/i&gt;+ ) : name} &lt;/a&gt; &lt;/p&gt;; })} å¿½ç•¥æ ¡éªŒçš„schema diff:include/schema/common/footer.json1- &quot;$ref&quot;: &quot;/misc/poly_links.json&quot;, _config.yml ä¸­é…ç½®å¦‚ä¸‹ _config.yml123456789footer: links: CC BY-NC-SA 4.0: icon: - fab fa-creative-commons - fab fa-creative-commons-by - fab fa-creative-commons-nc - fab fa-creative-commons-sa url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/' æ ·å¼ä¿®æ”¹ logo å’Œ faviconç”¨ Python è®¾è®¡ Logoï¼Œå¹¶å¾®è°ƒæ ·å¼ã€‚ æŒ‰é’®èƒŒæ™¯é¢œè‰²å¢åŠ æ¸å˜diff:include/style/widget.styl123456789 .widget .menu-list li ul margin-right: 0+ a+ transition: background-color 0.3s ease-in-out .level margin-bottom: 0 card å¢åŠ æµ®åŠ¨æ•ˆæœ:hover æ—¶å¢å¤§é˜´å½±ï¼Œå¹¶å¢åŠ åŠ¨ç”»å±æ€§ ease-in-outã€‚ diff:include/style/card.styl12345 .card overflow: visible border-radius: $card-radius+ &amp;:hover+ box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1) diff:source/js/animation.js123456 setTimeout(() =&gt; { $('body &gt; .navbar, body &gt; .section, body &gt; .footer').forEach(element =&gt; { element.style.opacity = '1';- element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';+ element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out'; }); diff:source/js/animation.js1234 element.style.transform = '';- element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';+ element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out'; }, i * 100); ä¿®æ”¹tagçš„é¢œè‰²diff:include/style/widget.styl1234567891011 .tags .tag:first-child- background: $primary- color: $primary-invert+ background: whitesmoke+ color: #4a4a4a .tag:last-child- background: $light-grey+ background: #e7e7e7 color: $white-invert æ›´æ–°2020-12-04 åŸºäº 4.1.1 ç‰ˆæœ¬é‡æ–°æ”¹åŠ¨ã€‚2021-09-06 åˆå¹¶ 4.4.0ï¼Œå®˜æ–¹ä¹Ÿæ”¯æŒæ–‡ç«  licensesé…ç½®å¤šä¸ªå›¾æ ‡ï¼Œä¸è¿‡ç›®å‰è¿˜æ˜¯è‡ªå·±å®ç°çš„ã€‚ æ€»ç»“è¿™é‡Œåªåˆ—ä¸¾äº†éƒ¨åˆ†æ”¹åŠ¨ï¼Œè¯¦ç»†çš„å·®å¼‚å¯ä»¥æŸ¥çœ‹ diffã€‚ æœ¬æ–‡ä¼šæŒç»­æ›´æ–°ï¼Œä¿æŒè·Ÿæœ€æ–°çš„åšå®¢æ•ˆæœä¸€è‡´ï¼Œå¸Œæœ›èƒ½ç»™ä½ è‡ªå®šä¹‰ä¸»é¢˜ä¸€äº›å¸®åŠ©ã€‚ å¦‚æœæœ‰å…¶ä»–æƒ³æ³•æˆ–è€…æ„è§ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ã€‚","link":"/2019/03/customize-icarus/"},{"title":"Javaè¿›é˜¶ â€” ç±»åŠ è½½æœºåˆ¶","text":"ç±»åŠ è½½æœºåˆ¶æ˜¯ Java æŠ€æœ¯ä½“ç³»ä¸­éå¸¸æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè´Ÿè´£æŠŠ class æ–‡ä»¶åŠ è½½åˆ° JVMã€‚ ç±»åŠ è½½å™¨å¯ä»¥è¯´æ˜¯ Java è¯­è¨€çš„ä¸€é¡¹åˆ›æ–°ï¼Œå®ƒæ˜¯æ—©æœŸ Java è¯­è¨€èƒ½å¤Ÿå¿«é€Ÿæµè¡Œçš„é‡è¦åŸå› ä¹‹ä¸€ã€‚ç±»åŠ è½½å™¨æœ€åˆæ˜¯ä¸ºäº†æ»¡è¶³ Java Applet çš„éœ€æ±‚è€Œè®¾è®¡å‡ºæ¥çš„ï¼Œåœ¨ä»Šå¤©ç”¨åœ¨æµè§ˆå™¨ä¸Šçš„ Java Applet æŠ€æœ¯åŸºæœ¬ä¸Šå·²ç»è¢«æ·˜æ±°ï¼Œä½†ç±»åŠ è½½å™¨å´åœ¨ç±»å±‚æ¬¡åˆ’åˆ†ã€OSGiã€ç¨‹åºçƒ­éƒ¨ç½²ã€ä»£ç åŠ å¯†ç­‰é¢†åŸŸå¤§æ”¾å¼‚å½©ï¼Œæˆä¸º Java æŠ€æœ¯ä½“ç³»ä¸­ä¸€å—é‡è¦çš„åŸºçŸ³ï¼Œå¯è°“æ˜¯å¤±ä¹‹æ¡‘æ¦†ï¼Œæ”¶ä¹‹ä¸œéš…ã€‚ â€”â€”ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ å¼€å§‹ä¹‹å‰å…ˆæŠ›å‡ºäº”ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹èƒ½å¦ç»™å‡ºå‡†ç¡®çš„å›ç­” å¦‚ä½•å¯åŠ¨ä¸€ä¸ª Java åº”ç”¨ï¼ŸJVM å¯åŠ¨çš„æ—¶å€™æ˜¯å¦‚ä½•æŸ¥æ‰¾ç±»çš„ï¼Ÿ æ˜¯å…ˆæœ‰çš„ Class è¿˜æ˜¯å…ˆæœ‰çš„ ClassLoaderï¼ŸJVM å¯åŠ¨çš„æ—¶å€™æ˜¯å¦‚ä½•å¤„ç† ClassLoader çš„ï¼Ÿ ClassLoader çš„å±‚æ¬¡ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼ŸcontextClassLoader æ˜¯ä»€ä¹ˆï¼Ÿ ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¼šé‡åˆ°å“ªäº›é”™è¯¯ Error æˆ–è€…å¼‚å¸¸ Exceptionï¼ŸNoClassDefFoundError å’Œ ClassNotFoundException åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è‡ªå®šä¹‰ ClassLoaderï¼Ÿå¦‚ä½•è‡ªå®šä¹‰ ClassLoaderï¼Ÿ Java åº”ç”¨å¯åŠ¨æ— è®ºæ˜¯é€šè¿‡ä»€ä¹ˆè„šæœ¬å¯åŠ¨è¿˜æ˜¯åœ¨ IDE é‡Œé¢ç›´æ¥æ‰§è¡Œï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡æ‰§è¡Œ java å‘½ä»¤ã€‚ IDEA å¯åŠ¨åº”ç”¨çš„ç¬¬ä¸€è¡Œæ—¥å¿— mvn å‘½ä»¤ï¼Œå…¶å®æ˜¯ä¸ªè„šæœ¬ apache-maven-3.6.3/bin/mvn12345678910111213141516# ...# Provide a &quot;standardized&quot; way to retrieve the CLI args that will# work with both Windows and non-Windows executions.MAVEN_CMD_LINE_ARGS=&quot;$MAVEN_CONFIG $@&quot;export MAVEN_CMD_LINE_ARGSexec &quot;$JAVACMD&quot; \\ $MAVEN_OPTS \\ $MAVEN_DEBUG_OPTS \\ -classpath &quot;${CLASSWORLDS_JAR}&quot; \\ &quot;-Dclassworlds.conf=${MAVEN_HOME}/bin/m2.conf&quot; \\ &quot;-Dmaven.home=${MAVEN_HOME}&quot; \\ &quot;-Dlibrary.jansi.path=${MAVEN_HOME}/lib/jansi-native&quot; \\ &quot;-Dmaven.multiModuleProjectDirectory=${MAVEN_PROJECTBASEDIR}&quot; \\ ${CLASSWORLDS_LAUNCHER} &quot;$@&quot; æ¥çœ‹ä¸€ä¸‹ java å‘½ä»¤çš„å¸®åŠ© 12345$ java -helpUsage: java [-options] class [args...] (to execute a class) or java [-options] -jar jarfile [args...] (to execute a jar file) æ–‡æ¡£ä¸­å¯¹äº Java å¯åŠ¨æ—¶ç±»æŸ¥æ‰¾çš„è¯´æ˜ https://docs.oracle.com/javase/8/docs/technotes/tools/findingclasses.html How the Java Launcher Finds Classes The Java launcher, java, initiates the Java virtual machine. The virtual machine searches for and loads classes in this order: Bootstrap classes - Classes that comprise the Java platform, including the classes in rt.jar and several other important jar files. Extension classes - Classes that use the Java Extension mechanism. These are bundled as .jar files located in the extensions directory. User classes - Classes defined by developers and third parties that do not take advantage of the extension mechanism. div.inline-code-gray code { color: steelblue !important } How the Java Launcher Finds User Classes User classes are classes which build on the Java platform. To find user classes, the launcher refers to the user class path â€“ a list of directories, JAR archives, and ZIP archives which contain class files.A class file has a subpath name that reflects the classâ€™s fully-qualified name. For example, if the class com.mypackage.MyClass is stored under /myclasses, then /myclasses must be in the user class path and the full path to the class file must be /myclasses/com/mypackage/MyClass.class. If the class is stored in an archive named myclasses.jar, then myclasses.jar must be in the user class path, and the class file must be stored in the archive as com/mypackage/MyClass.class.The user class path is specified as a string, with a colon (:) separating the class path entries on Solaris, and a semi-colon (;) separating entries on Microsoft Windows systems. The java launcher puts the user class path string in the java.class.path system property. The possible sources of this value are: The default value, â€œ.â€, meaning that user class files are all the class files in the current directory (or under it, if in a package). The value of the CLASSPATH environment variable, which overrides the default value. The value of the -cp or -classpath command line option, which overrides both the default value and the CLASSPATH value. The JAR archive specified by the -jar option, which overrides all other values. If this option is used, all user classes must come from the specified archive. IDE å’Œ mavenIDE ä¼šé€šè¿‡ maven æ’ä»¶ï¼Œè§£æé¡¹ç›®æ¨¡å—ï¼Œè®¡ç®— classpathï¼Œæœ€ç»ˆé€šè¿‡ -classpath å½±å“å¯åŠ¨ï¼Œæ‰€ä»¥ä¿®æ”¹ä¾èµ–çš„æ—¶å€™éœ€è¦é‡æ–°åŠ è½½é¡¹ç›®ã€‚ IDE å¤šæ¨¡å—çš„ classpathæ¯ä¸ªæ¨¡å—çš„ classpath æ˜¯ç‹¬ç«‹è®¡ç®—çš„ï¼Œåœ¨ä¸åŒæ¨¡å—å¯åŠ¨ main æ–¹æ³•çš„çš„æ—¶å€™ -classpath å‚æ•°æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚æœ‰ä¸¤ä¸ªæ¨¡å— A Bï¼ŒA ä¾èµ– B å’Œç¬¬ä¸‰æ–¹ C.jar , B ä¾èµ–ç¬¬ä¸‰æ–¹ D.jar 1234Aâ”œâ”€â”€ C.jarâ””â”€â”€ B â””â”€â”€D.jar æœ€ç»ˆå¯åŠ¨ A ä¸­çš„ main æ–¹æ³•ï¼ˆä¼šæŒ‡å‘å¯¹åº”æ¨¡å—çš„ target/classes ç›®å½•ï¼‰ 1java -classpath ${é¡¹ç›®}/A/target/classes:${é¡¹ç›®}/B/target/classes:${ä»“åº“}/C.jar:${ä»“åº“}/D.jar ... å¦‚æœæ˜¯å¯åŠ¨ B ä¸­çš„ main æ–¹æ³•ï¼ˆæ­¤æ—¶æ˜¯æ‰¾ä¸åˆ° A ä¸­å®šä¹‰ç±»çš„ï¼‰ 1java -classpath ${é¡¹ç›®}/B/target/classes:${ä»“åº“}/D.jar ... Spring åŒ…æ‰«æä¸ classpath çš„å…³ç³»Spring åªèƒ½æ‰«æç±»åŠ è½½èƒ½åŠ è½½åˆ°çš„ç±»ï¼Œå¯ä»¥ç®€å•è®¤ä¸ºå°±æ˜¯åªèƒ½åŠ è½½ classpath ä¸‹çš„ç±»ã€‚ Object Class ClassLoader (java.lang.*)ä»»ä½•å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œé‚£ä¹ˆ java.lang.String.class æ˜¯ä¸€ä¸ªå¯¹è±¡å—ï¼Ÿï¼ˆjava.lang.Class extend java.lang.Objectï¼‰ Class å®ä¾‹æ˜¯é€šè¿‡ ClassLoader çš„å®ä¾‹åŠ è½½çš„ï¼Œä½† ClassLoader å®ä¾‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿä¼šæœ‰ Classï¼Œä¸‹é¢è¿™å‡ ä¸ªå€¼æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ 1234Class.classClassLoader.classClass.class.getClassLoader()ClassLoader.class.getClassLoader() ä» JDK æºç çœ‹ç±»çš„åŠ è½½SystemDictionary ç®¡ç†äº†æ‰€æœ‰åŠ è½½çš„ç±» hotspot/src/share/vm/classfile/systemDictionary.hppsystemDictionary.hpp12345678class SystemDictionary : AllStatic { //... // Hashtable holding loaded classes. static Dictionary* _dictionary; //...} è€Œ Dictionary å°±æ˜¯ä¸€ä¸ª Hashtable hotspot/src/share/vm/classfile/dictionary.hppdictionary.hpp123class Dictionary : public TwoOopHashtable&lt;Klass*, mtClass&gt; { //...} å†æ¥çœ‹ä¸‹ Klass hotspot/src/share/vm/oops/klass.hppklass.hpp123456789// A Klass provides:// 1: language level class object (method dictionary etc.)// 2: provide vm dispatch behavior for the object// Both functions are combined into one C++ class.// ...class Klass : public Metadata { // ...} hotspot/src/share/vm/oops/instanceKlass.hppinstanceKlass.hpp123456789101112131415161718192021222324252627282930313233343536373839404142// An InstanceKlass is the VM level representation of a Java class.// It contains all information needed for at class at execution runtime.// InstanceKlass layout:// [C++ vtbl pointer ] Klass// [subtype cache ] Klass// [instance size ] Klass// [java mirror ] Klass// [super ] Klass// [access_flags ] Klass// [name ] Klass// [first subklass ] Klass// [next sibling ] Klass// [array klasses ]// [methods ]// [local interfaces ]// [transitive interfaces ]// [fields ]// [constants ]// [class loader ]// [source file name ]// [inner classes ]// [static field size ]// [nonstatic field size ]// [static oop fields size ]// [nonstatic oop maps size ]// [has finalize method ]// [deoptimization mark bit ]// [initialization state ]// [initializing thread ]// [Java vtable length ]// [oop map cache (stack maps) ]// [EMBEDDED Java vtable ] size in words = vtable_len// [EMBEDDED nonstatic oop-map blocks] size in words = nonstatic_oop_map_size// The embedded nonstatic oop-map blocks are short pairs (offset, length)// indicating where oops are located in instances of this klass.// [EMBEDDED implementor of the interface] only exist for interface// [EMBEDDED host klass ] only exist for an anonymous class (JSR 292 enabled)class InstanceKlass: public Klass { // ...} åœ¨ hotspot ä»£ç é‡Œé¢ Klass æ˜¯ç±»çš„åº•å±‚å®ç°ï¼Œç±»åŠ è½½æœ€ç»ˆçš„ç»“æœå°±æ˜¯åˆ›å»ºä¸€ä¸ª Klass ï¼ˆæˆ–å…¶å­ç±»ï¼‰å¯¹è±¡ï¼Œè€Œ SystemDictionary ç®¡ç†äº†æ‰€æœ‰çš„åŠ è½½çš„ç±»ã€‚ Java è™šæ‹Ÿæœºå¯åŠ¨æ¥çœ‹ä¸€ä¸‹ JVM å¯åŠ¨çš„æ—¶å€™è·Ÿ ClassLoader ç›¸å…³çš„ä¸»è¦æµç¨‹ï¼Œä» main æ–¹æ³•åˆ° java main æ–¹æ³• 12345678910111213141516171819main (jdk/src/share/bin/main.c)-&gt; JLI_Launch (jdk/src/share/bin/java.c) -&gt; LoadJavaVM (jdk/src/share/bin/java.c) // åŠ è½½åŠ¨æ€åº“æ‰¾åˆ°hotspotå®ç° -&gt; JVMInit (jdk/src/share/bin/java.c) -&gt; ContinueInNewThread (jdk/src/share/bin/java.c) -&gt; ContinueInNewThread0 (jdk/src/solaris/bin/java_md_solinux.c) -&gt; JavaMain (jdk/src/share/bin/java.c) -&gt; InitializeJVM (jdk/src/share/bin/java.c) -&gt; JNI_CreateJavaVM (hotspot/src/share/vm/prims/jni.cpp) -&gt; Threads::create_vm (hotspot/src/share/vm/runtime/thread.cpp) -&gt; init_globals (hotspot/src/share/vm/runtime/init.cpp) -&gt; universe2_init (hotspot/src/share/vm/runtime/universe.cpp) -&gt; Universe::genesis (hotspot/src/share/vm/runtime/universe.cpp) -&gt; SystemDictionary::initialize (hotspot/src/share/vm/classfile/systemDictionary.cpp) -&gt; SystemDictionary::initialize_preloaded_classes (hotspot/src/share/classfile/systemDictionary.cpp) -&gt; SystemDictionary::compute_java_system_loader (hotspot/src/share/classfile/systemDictionary.cpp) -&gt; LoadMainClass (jdk/src/share/bin/java.c) // åŠ è½½ MainClass -&gt; GetStaticMethodID (jdk/src/share/bin/java.c) // æ‰¾ main æ–¹æ³• -&gt; CallStaticVoidMethod (jdk/src/share/bin/java.c) // è°ƒç”¨ main æ–¹æ³• hotspot/src/share/vm/classfile/systemDictionary.hppsystemDictionary.hpp12345678910111213141516171819202122232425262728293031323334#define WK_KLASSES_DO(do_klass) \\ /* well-known classes */ \\ do_klass(Object_klass, java_lang_Object, Pre ) \\ do_klass(String_klass, java_lang_String, Pre ) \\ do_klass(Class_klass, java_lang_Class, Pre ) \\ do_klass(Cloneable_klass, java_lang_Cloneable, Pre ) \\ do_klass(ClassLoader_klass, java_lang_ClassLoader, Pre ) \\ do_klass(Serializable_klass, java_io_Serializable, Pre ) \\ do_klass(System_klass, java_lang_System, Pre ) \\ do_klass(Throwable_klass, java_lang_Throwable, Pre ) \\ do_klass(Error_klass, java_lang_Error, Pre ) \\ do_klass(ThreadDeath_klass, java_lang_ThreadDeath, Pre ) \\ do_klass(Exception_klass, java_lang_Exception, Pre ) \\ do_klass(RuntimeException_klass, java_lang_RuntimeException, Pre ) \\ do_klass(SecurityManager_klass, java_lang_SecurityManager, Pre ) \\ do_klass(ProtectionDomain_klass, java_security_ProtectionDomain, Pre ) \\ do_klass(AccessControlContext_klass, java_security_AccessControlContext, Pre ) \\ do_klass(ClassNotFoundException_klass, java_lang_ClassNotFoundException, Pre ) \\ do_klass(NoClassDefFoundError_klass, java_lang_NoClassDefFoundError, Pre ) \\ do_klass(LinkageError_klass, java_lang_LinkageError, Pre ) \\ do_klass(ClassCastException_klass, java_lang_ClassCastException, Pre ) \\ do_klass(ArrayStoreException_klass, java_lang_ArrayStoreException, Pre ) \\ do_klass(VirtualMachineError_klass, java_lang_VirtualMachineError, Pre ) \\ do_klass(OutOfMemoryError_klass, java_lang_OutOfMemoryError, Pre ) \\ do_klass(StackOverflowError_klass, java_lang_StackOverflowError, Pre ) \\ do_klass(IllegalMonitorStateException_klass, java_lang_IllegalMonitorStateException, Pre ) \\ do_klass(Reference_klass, java_lang_ref_Reference, Pre ) \\ \\ /* Preload ref klasses and set reference types */ \\ do_klass(SoftReference_klass, java_lang_ref_SoftReference, Pre ) \\ do_klass(WeakReference_klass, java_lang_ref_WeakReference, Pre ) \\ do_klass(FinalReference_klass, java_lang_ref_FinalReference, Pre ) \\ do_klass(PhantomReference_klass, java_lang_ref_PhantomReference, Pre ) \\ // ... hotspot/src/share/vm/classfile/systemDictionary.cppsystemDictionary.cpp123456789101112void SystemDictionary::initialize_preloaded_classes(TRAPS) { // ... initialize_wk_klasses_through(WK_KLASS_ENUM_NAME(Class_klass), scan, CHECK); // ... Universe::initialize_basic_type_mirrors(CHECK); // ... initialize_wk_klasses_through(WK_KLASS_ENUM_NAME(Reference_klass), scan, CHECK);. // ... initialize_wk_klasses_through(WK_KLASS_ENUM_NAME(PhantomReference_klass), scan, CHECK); // ... initialize_wk_klasses_until(WKID_LIMIT, scan, CHECK);} SystemClassLoaderé™¤äº† Bootstrap ClassLoader ä¹‹å¤–çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åœ¨ Java ä»£ç é‡Œé¢å®šä¹‰çš„ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ ClassLoader.getSystemClassLoader() java.lang.ClassLoader123456789101112131415161718192021222324252627282930313233343536public abstract class ClassLoader { // ... // The class loader for the system // @GuardedBy(&quot;ClassLoader.class&quot;) private static ClassLoader scl; // Set to true once the system class loader has been set // @GuardedBy(&quot;ClassLoader.class&quot;) private static boolean sclSet; // ... @CallerSensitive public static ClassLoader getSystemClassLoader() { initSystemClassLoader(); if (scl == null) { return null; } SecurityManager sm = System.getSecurityManager(); if (sm != null) { checkClassLoaderPermission(scl, Reflection.getCallerClass()); } return scl; } private static synchronized void initSystemClassLoader() { if (!sclSet) { if (scl != null) throw new IllegalStateException(&quot;recursive invocation&quot;); sun.misc.Launcher l = sun.misc.Launcher.getLauncher(); // ... sclSet = true; } }} sun.misc.Launcher12345678910111213141516171819202122232425public class Launcher { // ... public Launcher() { // Create the extension class loader ClassLoader extcl; try { extcl = ExtClassLoader.getExtClassLoader(); } catch (IOException e) { throw new InternalError(&quot;Could not create extension class loader&quot;, e); } // Now create the class loader to use to launch the application try { loader = AppClassLoader.getAppClassLoader(extcl); } catch (IOException e) { throw new InternalError(&quot;Could not create application class loader&quot;, e); } // Also set the context class loader for the primordial thread. Thread.currentThread().setContextClassLoader(loader); // ... }} åŒæ—¶å¯ä»¥çœ‹åˆ° AppClassLoader çš„ parent æ˜¯ ExtClassLoaderï¼ŒåŒæ—¶ SystemClassLoader ä¹Ÿæ˜¯åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–çš„ hotspot/src/share/vm/classfile/systemDictionary.cppsystemDictionary.cpp1234567891011void SystemDictionary::compute_java_system_loader(TRAPS) { KlassHandle system_klass(THREAD, WK_KLASS(ClassLoader_klass)); JavaValue result(T_OBJECT); JavaCalls::call_static(&amp;result, KlassHandle(THREAD, WK_KLASS(ClassLoader_klass)), vmSymbols::getSystemClassLoader_name(), vmSymbols::void_classloader_signature(), CHECK); _java_system_loader = (oop)result.get_jobject();} MainClass çš„åŠ è½½jdk/src/share/bin/java.cjava.c12345678910111213141516171819202122232425262728int JNICALL JavaMain(void * _args){ // ... mainClass = LoadMainClass(env, mode, what); // ... mainID = (*env)-&gt;GetStaticMethodID(env, mainClass, &quot;main&quot;, &quot;([Ljava/lang/String;)V&quot;); // ... /* Invoke main method. */ (*env)-&gt;CallStaticVoidMethod(env, mainClass, mainID, mainArgs); // ...}static jclass LoadMainClass(JNIEnv *env, int mode, char *name){ // ... jclass cls = GetLauncherHelperClass(env); // ... // sun.launcher.LauncherHelper#checkAndLoadMain NULL_CHECK0(mid = (*env)-&gt;GetStaticMethodID(env, cls, &quot;checkAndLoadMain&quot;, &quot;(ZILjava/lang/String;)Ljava/lang/Class;&quot;)); str = NewPlatformString(env, name); result = (*env)-&gt;CallStaticObjectMethod(env, cls, mid, USE_STDERR, mode, str); // ... return (jclass)result;} sun.launcher.LauncherHelper123456789101112public enum LauncherHelper { private static final ClassLoader scloader = ClassLoader.getSystemClassLoader(); public static Class&lt;?&gt; checkAndLoadMain(boolean printToStderr, int mode, String what) { // ... mainClass = scloader.loadClass(cn); // ... return mainClass; }} å› æ­¤ MainClass æ˜¯ç”± ClassLoader.getSystemClassLoader() åŠ è½½çš„ ä¸€äº›ç»“è®º ä» hotspot çš„è§’åº¦æ¥è®²ï¼Œæ‰€æœ‰ç±»éƒ½æ˜¯é€šè¿‡ Klass å¯¹è±¡æ¥æè¿°çš„ ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µ Object.class != Object ç±»ï¼Œå¯ä»¥è¯´ Object.class ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯ç”¨æ¥è¡¨ç¤ºåº•å±‚ï¼ˆC++ï¼‰Klass çš„ä¸€ä¸ªå¯¹è±¡ ä¸€å®šæ˜¯å…ˆæœ‰ç±»ï¼Œæ‰æœ‰å¯¹è±¡ã€‚ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œéƒ½ç»§æ‰¿è‡ªjava.lang.Objectï¼ˆé™¤äº†åŸºæœ¬ç±»å‹ï¼‰ åœ¨ JVM åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé¢„å…ˆåˆå§‹åŒ–ä¸€äº› Klass å¯¹è±¡ï¼ˆwell known classesï¼‰ï¼Œæ¥æè¿°å…·ä½“çš„ç±» æœ€æ—©åŠ è½½çš„å‡ ä¸ªç±»ï¼ˆæŒ‰ç…§é¡ºåºï¼‰java.lang.Object , java.lang.String , java.lang.Class , 9 ä¸ªåŸºæœ¬ç±»å‹ï¼ˆåŒ…å« Void.TYPEï¼‰, java.lang.Cloneable , java.lang.ClassLoader è¿™äº›ç±»æ˜¯é¢„åŠ è½½ï¼Œä¸éœ€è¦æœ‰ä¸€ä¸ª java.lang.ClassLoader çš„å®ä¾‹æ¥åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™ JVM éƒ½æ²¡æœ‰å®Œå…¨åˆå§‹åŒ– é»˜è®¤ä¼šæœ‰ä¸‰ä¸ª ClassLoaderï¼ŒBootstrap ClassLoader æ˜¯ C++å®ç°çš„ Class.class.getClassLoader() == null ï¼ˆBootstrap ClassLoader åœ¨ Java å±‚é¢å°±æ˜¯ nullï¼‰ ä¸»ç±»çš„ ClassLoader å°±æ˜¯ ClassLoader.getSystemClassLoader() Bootstrap ClassLoader çš„å­˜åœ¨æ˜¯ä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„äº‹æƒ…ï¼Œä¸éœ€è¦æ­»è®°ç¡¬èƒŒã€‚ ä¸‹é¢è¯­å¥åˆ†åˆ«è¾“å‡ºä»€ä¹ˆï¼Ÿ 12345678910public class Test { public static void main(String[] args) { System.out.println(Test.class.getClassLoader()); System.out.println(javax.sql.DataSource.class.getClassLoader()); System.out.println(String.class.getClassLoader()); System.out.println(ClassLoader.getSystemClassLoader()); System.out.println(ClassLoader.getSystemClassLoader().getParent()); System.out.println(ClassLoader.getSystemClassLoader().getParent().getParent()); }} å¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹ï¼Œä¸åŒç‰ˆæœ¬ä¼šæœ‰å·®å¼‚ã€‚ ç±»çš„åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–é€šè¿‡ç±»çš„å…¨åï¼ˆbinary nameï¼‰è·å–äºŒè¿›åˆ¶æµåŠ è½½åˆ° JVMï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª java.lang.Class å¯¹è±¡è¡¨ç¤ºè¿™ä¸ªç±»ã€‚ å›¾ç‰‡æ¥æºäºç½‘ç»œ æ¥çœ‹ä¸€ä¸‹ Java è™šæ‹Ÿæœºè§„èŒƒå…³äºç±»åŠ è½½çš„æè¿° https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html How the Java Launcher Finds Classes The Java launcher, java, initiates the Java virtual machine. The virtual machine searches for and loads classes in this order: Bootstrap classes - Classes that comprise the Java platform, including the classes in rt.jar and several other important jar files. Extension classes - Classes that use the Java Extension mechanism. These are bundled as .jar files located in the extensions directory. User classes - Classes defined by developers and third parties that do not take advantage of the extension mechanism. ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª ClassLoader Bootstrap ClassLoader (C++ null) ExtClassLoader (SystemDictionary::compute_java_system_loader æ—¶åˆå§‹åŒ–) AppClassLoader (SystemDictionary::compute_java_system_loader æ—¶åˆå§‹åŒ–) åç»­ ExtClassLoader æŒ‡ sun.misc.Launcher$ExtClassLoader ä¸€ä¸ªçš„å®ä¾‹ï¼ŒAppClassLoader æŒ‡ sun.misc.Launcher$AppClassLoader çš„ä¸€ä¸ªçš„å®ä¾‹ ç±»å‹åˆ¤æ–­ä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œæ˜¯æŒ‡å…¨åï¼ˆbinary nameï¼‰ç›¸ç­‰ä¸”æ˜¯åŒä¸€ä¸ªç±»åŠ è½½å™¨å®ŒæˆåŠ è½½çš„ã€‚åŒ…æ‹¬å…¼å®¹æ€§åˆ¤æ–­ java.lang.Class.isAssignableFrom java.lang.Class.isInstance java.lang.Class.equals instanceof å…³é”®å­— ç±»å‹è½¬æ¢ é‚£ä¹ˆä¸åŒç±»åŠ è½½å™¨åœ¨åŠ è½½åŒä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å¤„ç† 123456789101112131415public class Test { public static void main(String[] args) throws ClassNotFoundException { String name = &quot;java.lang.Object&quot;; Class&lt;?&gt; objectClass1 = Object.class; Class&lt;?&gt; objectClass2 = ClassLoader.getSystemClassLoader().loadClass(name); Class&lt;?&gt; objectClass3 = new URLClassLoader(new URL[0]).loadClass(name); objectClass2.isAssignableFrom(Test.class); objectClass3.isInstance(new Test()); objectClass1.getClassLoader(); // null objectClass2.getClassLoader(); // ? objectClass3.getClassLoader(); // ? }} å¦‚æœæ¯ä¸ª ClassLoader éƒ½å»åŠ è½½ä¸€é java.lang.Object é‚£ä¹ˆä¸åŒç±»åŠ è½½åŠ è½½çš„ Class æ˜¯ä¸æ˜¯ç›¸ç­‰çš„ï¼Ÿå¦‚æœä¸æƒ³ç­‰å¯¹è±¡å°±æ²¡æœ‰åŠæ³•ç›¸äº’è½¬æ¢ï¼Œé‚£ä¹ˆæ•´ä¸ªç¨‹åºå°±ä¼šè¡¨ç°çš„å¾ˆå¥‡æ€ªï¼Œä»è¿™ä¸ªè§’åº¦ä¸Šè®² AppClassLoader å»åŠ è½½ Bootstrap classes ä¹Ÿåº”è¯¥æ˜¯ç”± Bootstrap ClassLoader åŠ è½½çš„ AppClassLoader å»åŠ è½½ Extension classes ä¹Ÿåº”è¯¥æ˜¯ç”± ExtClassLoader åŠ è½½çš„ ExtClassLoader å»åŠ è½½ Bootstrap classes ä¹Ÿåº”è¯¥æ˜¯ç”± Bootstrap ClassLoader åŠ è½½çš„ è¿™å°±æ˜¯ä¸€ä¸ªå§”æ‰˜ï¼ˆdelegationï¼‰çš„æ¨¡å‹ã€‚ åŒäº²å§”æ´¾æ¥çœ‹ä¸€ä¸‹ ClassLoader æ˜¯å¦‚ä½•åŠ è½½ä¸€ä¸ªç±»çš„https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html The ClassLoader class uses a delegation model to search for classes and resources. Each instance of ClassLoader has an associated parent class loader. When requested to find a class or resource, a ClassLoader instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machineâ€™s built-in class loader, called the â€œbootstrap class loaderâ€, does not itself have a parent but may serve as the parent of a ClassLoader instance. è¿™ä¸ªä¸€èˆ¬å°±ç§°ä¸ºåŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Model ï¼‰ã€‚ è¿™ä¸ªåè¯çš„ç¿»è¯‘ä¸å¥½ï¼Œâ€œåŒâ€è¿™ä¸ªå­—ä¸æ˜¯å¾ˆå‡†ç¡® java.lang.ClassLoader12345678910111213public abstract class ClassLoader { private static native void registerNatives(); static { registerNatives(); } // The parent class loader for delegation // Note: VM hardcoded the offset of this field, thus all new fields // must be added *after* it. private final ClassLoader parent; // ...} å…¶ä¸­ AppClassLoader çš„ parent æ˜¯ ExtClassLoaderï¼ŒExtClassLoader çš„ parent æ˜¯ Bootstrap ClassLoaderï¼ˆnullï¼‰ï¼Œè¿™ä¸ªè·Ÿä¹‹å‰çš„ç†è§£æ˜¯ä¸€è‡´çš„ AppClassLoader å»åŠ è½½ Bootstrap classes ä¹Ÿåº”è¯¥æ˜¯ç”± Bootstrap ClassLoader åŠ è½½çš„ AppClassLoader å»åŠ è½½ Extension classes ä¹Ÿåº”è¯¥æ˜¯ç”± ExtClassLoader åŠ è½½çš„ ExtClassLoader å»åŠ è½½ Bootstrap classes ä¹Ÿåº”è¯¥æ˜¯ç”± Bootstrap ClassLoader åŠ è½½çš„ åŠ è½½ç±»å¯¹åº”çš„æ–¹æ³•https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html#loadClass-java.lang.String-boolean- java.lang.ClassLoader123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public abstract class ClassLoader { // ... protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // First, check if the class has already been loaded Class&lt;?&gt; c = findLoadedClass(name); if (c == null) { long t0 = System.nanoTime(); try { if (parent != null) { c = parent.loadClass(name, false); } else { c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { // ClassNotFoundException thrown if class not found // from the non-null parent class loader } if (c == null) { // If still not found, then invoke findClass in order // to find the class. // ... c = findClass(name); } } if (resolve) { resolveClass(c); } return c; } } // ... /** * Finds the class with the specified &lt;a href=&quot;#name&quot;&gt;binary name&lt;/a&gt;. * This method should be overridden by class loader implementations that * follow the delegation model for loading classes, and will be invoked by * the {@link #loadClass &lt;tt&gt;loadClass&lt;/tt&gt;} method after checking the * parent class loader for the requested class. The default implementation * throws a &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;. */ protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { throw new ClassNotFoundException(name); } // ...} å›¾ç‰‡æ¥æºäºç½‘ç»œ ä»ä¸Šé¢çš„ä»£ç æ¥çœ‹ï¼ŒåŒäº²å§”æ´¾çš„å®ç°æ—¶éå¸¸ç®€å•çš„ã€‚é‚£ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾ï¼Ÿæ€»æ„Ÿè§‰è¿™ä¸ªé—®é¢˜ä¸æ˜¯å¾ˆå¥½å›ç­”ï¼Œå› ä¸ºä»ä¸Šé¢çš„åˆ†ææ¥çœ‹ï¼Œå¦‚æœæ˜¯è¿™ä¸ª ClassLoader çš„æ¨¡å‹ï¼Œé‚£ä¹ˆåŒäº²å§”æ´¾å°±æ˜¯æ¯”è¾ƒè‡ªç„¶çš„æ–¹æ¡ˆ ä¿è¯ç±»çš„å”¯ä¸€æ€§ é¿å…é‡å¤åŠ è½½ å®‰å…¨ï¼Œæ ¸å¿ƒç±»ä¸ä¼šè¢«ç¯¡æ”¹ï¼ˆæ¯”å¦‚ -classpath ä¸­åŒ…å« java.lang.Objectï¼Œä½†å§”æ‰˜ç»™ Bootstrap ClassLoader ä¹‹åå°±åªèƒ½åŠ è½½é»˜è®¤çš„ç±»ï¼‰ ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œjava. å¼€å¤´çš„ç±»æ˜¯ä¸èƒ½å»å®šä¹‰çš„ï¼ˆä¾‹å¦‚åœ¨ -classpath ä¸­åŒ…å« java.lang.Object2ï¼‰ java.lang.ClassLoader1234567891011private ProtectionDomain preDefineClass(String name, ProtectionDomain pd){ // ... // relies on the fact that spoofing is impossible if a class has a name // of the form &quot;java.*&quot; if ((name != null) &amp;&amp; name.startsWith(&quot;java.&quot;)) { throw new SecurityException(&quot;Prohibited package name: &quot; + name.substring(0, name.lastIndexOf('.'))); } // ...} è¿™é‡Œæœ‰å¯¹ä¸Šè¿°è¿‡ç¨‹æ›´è¯¦ç»†çš„è§£é‡Šhttps://docs.oracle.com/javase/8/docs/technotes/guides/security/spec/security-spec.doc5.html SPI ä¸ ContextClassLoaderæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ SPI 12345678public class Test { public static void main(String[] args) { Connection conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/mysql&quot;, &quot;root&quot;, &quot;123456&quot;); System.out.println(conn.getClass() == com.mysql.cj.jdbc.ConnectionImpl.class); System.out.println(com.mysql.cj.jdbc.ConnectionImpl.class.getClassLoader()); System.out.println(DriverManager.class.getClassLoader()); }} å¯èƒ½è¿™é‡Œçœ‹ä¸Šå»æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ DriverManager æ˜¯ Bootstrap ClassLoader åŠ è½½çš„ï¼Œæœ€ç»ˆ ConnectionImpl æ˜¯åº”ç”¨è‡ªå·±çš„ classpath ä¸‹ï¼Œæ˜¯ AppClassLoader åŠ è½½çš„ã€‚ é‚£èƒ½ä¸èƒ½å†™æ­» SPI å°±ç”¨ java.lang.ClassLoader.getSystemClassLoader() æ¥åŠ è½½å‘¢ï¼Ÿ æ¥çœ‹ä¸€ä¸‹ DriverManager æ˜¯å¦‚ä½•åŠ è½½å…·ä½“ Driver å®ç°çš„ java.sql.DriverManager12345678910111213141516public class DriverManager { // ... static { loadInitialDrivers(); } // ... private static void loadInitialDrivers() { // ... // SPI ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator(); // ... }} java.util.ServiceLoader12345678public final class ServiceLoader&lt;S&gt; implements Iterable&lt;S&gt; { // ... public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) { ClassLoader cl = Thread.currentThread().getContextClassLoader(); return ServiceLoader.load(service, cl); } // ...} è§£å†³è¿™ä¸ªé—®é¢˜æ˜¯é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ Thread.currentThread().getContextClassLoader() ï¼Œæ¯ä¸ªçº¿ç¨‹ç»‘å®šä¸€ä¸ªç±»åŠ è½½å™¨ 12345Thread.currentThread().setContextClassLoader(classloader1)ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);Thread.currentThread().setContextClassLoader(classloader2)ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); ContextClassLoader å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„è®¾è®¡ï¼Œä¸è¿‡ä¸€èˆ¬åœ¨ä»£ç ä¸­å¾ˆå°‘éœ€è¦å…³æ³¨ã€‚ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å„ç§æ¡†æ¶ï¼Œæ¡†æ¶åˆ©ç”¨ä¸Šä¸‹æ–‡åŠ è½½å™¨åŠ è½½å¯¹åº”çš„èµ„æºæˆ–è€…ç±»ã€‚ åŒäº²å§”æ´¾æœºåˆ¶çš„ç ´ååŒäº²å§”æ´¾çš„æ ¸å¿ƒå°±æ˜¯ parent å±æ€§å’Œ loadClass æ–¹æ³• java.lang.ClassLoader1protected Class&lt;?&gt; loadClass(String name, boolean resolve) protected è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œå› æ­¤åŒäº²å§”æ´¾ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œè‚¯å®šæœ‰ä¸€äº›åœºæ™¯æ˜¯å¯ä»¥æ”¹å†™è¿™ä¸ªé€»è¾‘çš„ã€‚ ä¸€èˆ¬è®¤ä¸º SPI æ˜¯ç ´åäº†åŒäº²å§”æ´¾æœºåˆ¶çš„ï¼ˆå§”æ´¾ç»™å¦å¤–ä¸€ä¸ªä¸Šä¸‹æ–‡ ClassLoader è€Œä¸ parentï¼‰ï¼Œæ­¤å¤–å°±æ˜¯è¦†ç›– loadClass æ–¹æ³•ç ´ååŒäº²å§”æ´¾çš„æœºåˆ¶ï¼Œå…·ä½“çš„ä½¿ç”¨åœºæ™¯åé¢ä¼šè®²ã€‚ ç±»çš„åˆå§‹åŒ–æ—¶æœºhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html Initialization of a class or interface consists of executing its class or interface initialization method (Â§2.9). A class or interface C may be initialized only as a result of: The execution of any one of the Java Virtual Machine instructions new, getstatic, putstatic, or invokestatic that references C (Â§new, Â§getstatic, Â§putstatic, Â§invokestatic). These instructions reference a class or interface directly or indirectly through either a field reference or a method reference.Upon execution of a new instruction, the referenced class is initialized if it has not been initialized already.Upon execution of a getstatic, putstatic, or invokestatic instruction, the class or interface that declared the resolved field or method is initialized if it has not been initialized already. The first invocation of a java.lang.invoke.MethodHandle instance which was the result of method handle resolution (Â§5.4.3.5) for a method handle of kind 2 (REF_getStatic), 4 (REF_putStatic), 6 (REF_invokeStatic), or 8 (REF_newInvokeSpecial).This implies that the class of a bootstrap method is initialized when the bootstrap method is invoked for an invokedynamic instruction (Â§invokedynamic), as part of the continuing resolution of the call site specifier. Invocation of certain reflective methods in the class library (Â§2.12), for example, in class Class or in package java.lang.reflect. If C is a class, the initialization of one of its subclasses. If C is an interface that declares a non-abstract, non-static method, the initialization of a class that implements C directly or indirectly. If C is a class, its designation as the initial class at Java Virtual Machine startup (Â§5.2). æœ‰ä¸”åªæœ‰ä¸Šè¿° 6 ç§æƒ…å†µï¼ˆä¸”è¿™ä¸ªç±»æ²¡æœ‰è¢«åŠ è½½ï¼‰ä¼šå»åŠ è½½ä¸€ä¸ªç±»ï¼Œç®€å•æ¥è¯´ new è¯»å–/ä¿®æ”¹é™æ€å˜é‡ï¼ˆæ’é™¤åœ¨å¸¸é‡æ± çš„ï¼‰è°ƒç”¨é™æ€æ–¹æ³• åŠ¨æ€è¯­è¨€æ”¯æŒ java.lang.invoke.MethodHandle ç›¸å…³ class library ä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚ Class å’Œ ClassLoader çš„éƒ¨åˆ†æ–¹æ³•ã€åå°„ï¼ˆjava.lang.reflectï¼‰ç­‰ åˆå§‹åŒ–ç±»çš„æŸä¸ªå­ç±»çš„æ—¶å€™ åˆå§‹åŒ–åŒ…å«é»˜è®¤æ–¹æ³•æ¥å£çš„æŸä¸ªå®ç°ç±»çš„ Java å¯åŠ¨ç±»ï¼ˆmain Classï¼‰ å…¶ä¸­ 4 å’Œ 5 å¯ä»¥ç»Ÿä¸€æˆä¸€ä¸ªé€’å½’çš„æè¿°ï¼Œå¦‚æœè¦åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–çˆ¶ç±»å’ŒåŒ…å« default æ–¹æ³•çš„æ¥å£ã€‚6 åœ¨å®ç°çš„æ—¶å€™å…¶å®å±äº 3 çš„ï¼Œæ˜¯é€šè¿‡java.lang.ClassLoader.loadClassåŠ è½½çš„ï¼ˆsun.launcher.LauncherHelperï¼‰ã€‚ ç±»åŠ è½½çš„ç›¸å…³å¼‚å¸¸ç±»åŠ è½½è¿‡ç¨‹ï¼Œéœ€è¦è¿›è¡ŒéªŒè¯ï¼Œæ¯”å¦‚æ–‡ä»¶æ ¼å¼ã€JAVA ç‰ˆæœ¬ã€final çº¦æŸã€å¯è®¿é—®æ€§çº¦æŸç­‰ï¼Œå…·ä½“ç»†èŠ‚å°±ä¸èµ˜è¿°äº† åŒæ—¶è¿˜æœ‰ä¸€ä¸ªæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å¼‚å¸¸ 12345678910try { if (parent != null) { c = parent.loadClass(name, false); } else { c = findBootstrapClassOrNull(name); }} catch (ClassNotFoundException e) { // ClassNotFoundException thrown if class not found // from the non-null parent class loader} åœ¨åŒäº²å§”æ´¾çš„è¿‡ç¨‹ä¸­ parent å¦‚æœåŠ è½½ä¸äº†æŸä¸ªç±»ï¼Œéœ€è¦æŠ›å‡º java.lang.ClassNotFoundExceptionï¼ˆè¿™é‡Œåª catch äº†è¿™ä¸ªå¼‚å¸¸ï¼‰ã€‚ public class ClassNotFoundException extends ReflectiveOperationException Thrown when an application tries to load in a class through its string name using: The forName method in class Class. The findSystemClass method in class ClassLoader . The loadClass method in class ClassLoader.but no definition for the class with the specified name could be found. public class NoClassDefFoundError extends LinkageError Thrown if the Java Virtual Machine or a ClassLoader instance tries to load in the definition of a class (as part of a normal method call or as part of creating a new instance using the new expression) and no definition of the class could be found.The searched-for class definition existed when the currently executing class was compiled, but the definition can no longer be found. java.lang.NoClassDefFoundError æ˜¯ä¸€ä¸ª Errorï¼Œå‘ç”Ÿåœ¨å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼ˆç±»å·²ç»æ‰¾åˆ°äº†ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯è¿™ä¸ªç±»ä¾èµ–çš„æŸäº›å®šä¹‰ä¸å­˜åœ¨ï¼Œä¸€èˆ¬ä¼šå‡ºç°åœ¨ jar åŒ…çš„ç‰ˆæœ¬ä¸å…¼å®¹ä¸Šã€‚ ç±»çš„å¸è½½æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œåˆ™ç±»ä¼šè¢«å¸è½½ è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹ï¼ˆåŒ…å«å­ç±»çš„å®ä¾‹ï¼‰éƒ½è¢«å›æ”¶ è¯¥ç±»çš„ ClassLoader ä¸å­˜åœ¨ä»»ä½•å¼•ç”¨ è¯¥ç±»çš„ Class å¯¹è±¡ä¸å­˜åœ¨ä»»ä½•å¼•ç”¨ï¼ˆåŒ…æ‹¬ç›¸å…³çš„ Method Field ç­‰ï¼Œæ— æ³•é€šè¿‡åå°„è®¿é—®ï¼‰ æ³¨æ„é»˜è®¤çš„ä¸‰ä¸ªç±»åŠ è½½å¯¹åº”çš„ç±»æ˜¯ä¸ä¼šè¢«å¸è½½çš„ï¼ˆClassLoader ä¼šä¸€ç›´è¢«å¼•ç”¨ï¼‰ã€‚ è‡ªå®šä¹‰ ClassLoaderå¦‚ä½•è‡ªå®šä¹‰ ClassLoaderä¸€èˆ¬æ˜¯ç»§æ‰¿ java.net.URLClassLoader æˆ–è€…ç›´æ¥ç»§æ‰¿ java.lang.ClassLoaderï¼Œç„¶åè¦†ç›– findClass æˆ– loadClass æ–¹æ³• è¦†ç›– findClassè¿™ç§ä¿®æ”¹ä¸€èˆ¬ä¸ç ´ååŒäº²å§”æ´¾ï¼Œä¼šä¿®æ”¹æŸ¥æ‰¾ç±»çš„é€»è¾‘ï¼Œå®ç°æŸäº›åŠ¨æ€çš„é€»è¾‘ã€‚å¯ä»¥å®ç°ä½†ä¸é™äºä»¥ä¸‹çš„é€»è¾‘ ä»ç½‘ç»œè·å– ä»ç‰¹å®šç›®å½•è·å– ç‰¹å®šç›®å½•ç»“æ„çš„å‹ç¼©åŒ… War åŒ… WEB-INF SpringBoot FatJar å¯¹äºŒè¿›åˆ¶æµåšé¢„å¤„ç†ï¼Œä¾‹å¦‚è§£å¯†æˆ–éªŒè¯ç­¾å å†…å­˜ç›´æ¥å®šä¹‰ Class æ–‡ä»¶ï¼ˆé…åˆå­—èŠ‚ç çš„åº“ï¼‰ï¼ˆåŠ¨æ€ä»£ç†ï¼‰ å®ç°çƒ­åŠ è½½ ç±»ä¼¼ JSP çš„æŠ€æœ¯ â€¦ è¦†ç›– loadClassä¸€èˆ¬æ˜¯ä¿®æ”¹ç±»åŠ è½½çš„å±‚çº§ç»“æ„ï¼Œå¯ä»¥å®ç°ä½†ä¸é™äºä»¥ä¸‹çš„é€»è¾‘ æ¨¡å—åŒ– è‡ªå®šä¹‰æŸç§ç±»éš”ç¦»çš„æœºåˆ¶ï¼Œä¾‹å¦‚ Tomcat â€¦ å½“ç„¶ä¸Šé¢ä¸¤ç§ä¹Ÿå¯ä»¥è¿›è¡Œç»„åˆ åº”ç”¨åœºæ™¯SpringBootspring boot åº”ç”¨æ‰“åŒ…ä¹‹åå¯ä»¥ç›´æ¥é€šè¿‡ java -jar å‘½ä»¤å¯åŠ¨ ã€‚ å®ç°åŸç†æ˜¯ spring-boot-maven-plugin åœ¨æ„å»ºï¼ˆrepackageï¼‰çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ org.springframework.boot.maven.RepackageMojo æ‰“åŒ…æˆç‰¹å®šç»“æ„çš„ Jar åŒ…https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#packaging.layers org.springframework.boot.loader.tools.Layouts.Jar12345678910111213141516171819202122232425262728293031/** * Executable JAR layout. */public static class Jar implements RepackagingLayout { @Override public String getLauncherClassName() { return &quot;org.springframework.boot.loader.JarLauncher&quot;; } @Override public String getLibraryDestination(String libraryName, LibraryScope scope) { return &quot;BOOT-INF/lib/&quot;; } @Override public String getClassesLocation() { return &quot;&quot;; } @Override public String getRepackagedClassesLocation() { return &quot;BOOT-INF/classes/&quot;; } @Override public boolean isExecutable() { return true; } // ...} å¯ä»¥æ‰¾ä¸€ä¸ª spring boot çš„ Fat Jar è§£å‹çœ‹ä¸€ä¸‹çœ‹çœ‹ 1234567891011121314151617181920212223242526.â”œâ”€â”€ BOOT-INFâ”‚ â”œâ”€â”€ classesâ”‚ â”‚ â”œâ”€â”€ application.propertiesâ”‚ â”‚ â””â”€â”€ comâ”‚ â”‚ â””â”€â”€ exampleâ”‚ â”‚ â””â”€â”€ demoâ”‚ â”‚ â””â”€â”€ DemoApplication.classâ”‚ â”œâ”€â”€ classpath.idxâ”‚ â”œâ”€â”€ layers.idxâ”‚ â””â”€â”€ libâ”‚ â”œâ”€â”€ ...â”‚ â”œâ”€â”€ spring-boot-2.5.4.jarâ”‚ â”œâ”€â”€ spring-boot-autoconfigure-2.5.4.jarâ”‚ â”œâ”€â”€ spring-context-5.3.9.jarâ”‚ â””â”€â”€ spring-core-5.3.9.jarâ”œâ”€â”€ META-INFâ”‚ â””â”€â”€ MANIFEST.MFâ””â”€â”€ org â””â”€â”€ springframework â””â”€â”€ boot â””â”€â”€ loader â”œâ”€â”€ JarLauncher.class â”œâ”€â”€ LaunchedURLClassLoader.class â”œâ”€â”€ Launcher.class â”œâ”€â”€ ... java -jar å‘½ä»¤ä¼šåœ¨ MANIFEST.MF é‡Œé¢æ‰¾ Main-Class æ¥è¿è¡Œï¼Œçœ‹ä¸‹ META-INF/MANIFEST.MF æ–‡ä»¶å†…å®¹ META-INF/MANIFEST.MF123456789101112Manifest-Version: 1.0Spring-Boot-Classpath-Index: BOOT-INF/classpath.idxImplementation-Title: demoImplementation-Version: 0.0.1-SNAPSHOTSpring-Boot-Layers-Index: BOOT-INF/layers.idxStart-Class: com.example.demo.DemoApplicationSpring-Boot-Classes: BOOT-INF/classes/Spring-Boot-Lib: BOOT-INF/lib/Build-Jdk-Spec: 1.8Spring-Boot-Version: 2.5.4Created-By: Maven Jar Plugin 3.2.0Main-Class: org.springframework.boot.loader.JarLauncher é‚£ä¹ˆæ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢ï¼Ÿ org.springframework.boot.loader.JarLauncher1234567891011121314151617181920212223242526public class JarLauncher extends ExecutableArchiveLauncher { static final String BOOT_INF_CLASSES = &quot;BOOT-INF/classes/&quot;; static final String BOOT_INF_LIB = &quot;BOOT-INF/lib/&quot;; public JarLauncher() { } protected JarLauncher(Archive archive) { super(archive); } @Override protected boolean isNestedArchive(Archive.Entry entry) { if (entry.isDirectory()) { return entry.getName().equals(BOOT_INF_CLASSES); } return entry.getName().startsWith(BOOT_INF_LIB); } public static void main(String[] args) throws Exception { new JarLauncher().launch(args); } // ...} org.springframework.boot.loader.ExecutableArchiveLauncher123456789101112131415161718192021222324252627282930public abstract class ExecutableArchiveLauncher extends Launcher { // ... @Override protected String getMainClass() throws Exception { Manifest manifest = this.archive.getManifest(); String mainClass = null; if (manifest != null) { mainClass = manifest.getMainAttributes().getValue(&quot;Start-Class&quot;); } if (mainClass == null) { throw new IllegalStateException(&quot;No 'Start-Class' manifest entry specified in &quot; + this); } return mainClass; } @Override protected List&lt;Archive&gt; getClassPathArchives() throws Exception { List&lt;Archive&gt; archives = new ArrayList&lt;Archive&gt;(this.archive.getNestedArchives(new EntryFilter() { @Override public boolean matches(Entry entry) { return isNestedArchive(entry); } })); postProcessClassPathArchives(archives); return archives; } // ...} org.springframework.boot.loader.Launcher123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public abstract class Launcher { /** * Launch the application. This method is the initial entry point that should be * called by a subclass {@code public static void main(String[] args)} method. * @param args the incoming arguments * @throws Exception if the application fails to launch */ protected void launch(String[] args) throws Exception { JarFile.registerUrlProtocolHandler(); ClassLoader classLoader = createClassLoader(getClassPathArchives()); launch(args, getMainClass(), classLoader); } /** * Create a classloader for the specified archives. * @param archives the archives * @return the classloader * @throws Exception if the classloader cannot be created */ protected ClassLoader createClassLoader(List&lt;Archive&gt; archives) throws Exception { List&lt;URL&gt; urls = new ArrayList&lt;URL&gt;(archives.size()); for (Archive archive : archives) { urls.add(archive.getUrl()); } return createClassLoader(urls.toArray(new URL[urls.size()])); } /** * Create a classloader for the specified URLs. * @param urls the URLs * @return the classloader * @throws Exception if the classloader cannot be created */ protected ClassLoader createClassLoader(URL[] urls) throws Exception { return new LaunchedURLClassLoader(urls, getClass().getClassLoader()); } /** * Launch the application given the archive file and a fully configured classloader. * @param args the incoming arguments * @param mainClass the main class to run * @param classLoader the classloader * @throws Exception if the launch fails */ protected void launch(String[] args, String mainClass, ClassLoader classLoader) throws Exception { Thread.currentThread().setContextClassLoader(classLoader); createMainMethodRunner(mainClass, args, classLoader).run(); } // ...} å› ä¸ºæ˜¯ Fat Jar çš„æ¨¡å¼ï¼ˆJar in Jarï¼‰ï¼Œå› æ­¤éœ€è¦è‡ªå·±å®ç° LaunchedURLClassLoader æ¥å®šåˆ¶ç±»çš„æŸ¥æ‰¾é€»è¾‘ã€‚ TomcatTomcat å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ª web åº”ç”¨ï¼Œå¹¶ä¸”å¯ä»¥çƒ­åŠ è½½ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½æˆ–è€…å¸è½½ web åº”ç”¨ã€‚å¤§æ¦‚çš„å®ç°æ€è·¯ Tomcat è‡ªèº«çš„ä»£ç ä¼šæœ‰ä¸€ä¸ª ClassLoader Tomcat ä¸ºæ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ª org.apache.catalina.loader.WebappClassLoader åŠ è½½ Web åº”ç”¨è‡ªå·±çš„ç±»ï¼Œä¸” parent ä¼šæŒ‡å‘ Tomcat è‡ªèº«çš„ç±»åŠ è½½å™¨ WebappClassLoader åŠ è½½çš„æ—¶å€™ ä¼šå…ˆé€šè¿‡ javaseClassLoader åŠ è½½ï¼Œé»˜è®¤ä¸º ClassLoader.getSystemClassLoader().getParent() éƒ¨åˆ†ç±»ä¼šé€šè¿‡ parent æ¥è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·åº”ç”¨å¯ä»¥å…±äº«ä¸€äº›ç±»çš„å®šä¹‰ï¼ˆä¾‹å¦‚ javax.servlet.* å’Œ org.apache.tomcat.*ï¼‰ ä¹‹åä¼šåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±»ï¼Œå› æ­¤å¯ä»¥å®ç°ä¸åŒåº”ç”¨ä¹‹é—´çš„ç±»æ˜¯éš”ç¦»çš„ ä¸Šè¿°è¿‡ç¨‹ä¼šç ´ååŒäº²å§”æ´¾çš„æ¨¡å‹ã€‚æ¥çœ‹ä¸€ä¸‹ Tomcat çš„ç›®å½•ç»“æ„ï¼Œwebapps ç›®å½•ä¸‹åŒ…å«äº†æ‰€æœ‰çš„ Web åº”ç”¨ 12345678910111213141516171819202122.â”œâ”€â”€ binâ”‚ â”œâ”€â”€ ...â”‚ â”œâ”€â”€ shutdown.shâ”‚ â””â”€â”€ startup.shâ”œâ”€â”€ confâ”‚ â”œâ”€â”€ ...â”‚ â”œâ”€â”€ server.xmlâ”‚ â””â”€â”€ web.xmlâ”œâ”€â”€ libâ”‚ â”œâ”€â”€ ...â”‚ â”œâ”€â”€ servlet-api.jarâ”‚ â”œâ”€â”€ tomcat-api.jarâ”‚ â””â”€â”€ tomcat-websocket.jarâ”œâ”€â”€ logsâ”œâ”€â”€ webappsâ”‚ â”œâ”€â”€ ROOTâ”‚ â”œâ”€â”€ docsâ”‚ â”œâ”€â”€ examplesâ”‚ â”œâ”€â”€ host-managerâ”‚ â””â”€â”€ managerâ””â”€â”€ work Tomcat æ–‡æ¡£å…³äº WebappClassLoaderBase.loadClass çš„æè¿° https://tomcat.apache.org/tomcat-8.5-doc/api/org/apache/catalina/loader/WebappClassLoaderBase.html org.apache.catalina.loader.WebappClassLoaderBase12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394public abstract class WebappClassLoaderBase extends URLClassLoader implements ... { // ... @Override public Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { // ... // (0) Check our previously loaded local class cache // ... // (0.1) Check our previously loaded class cache // ... // ä¹‹å‰ä¼šåˆ¤æ–­æ˜¯å¦å·²ç»åŠ è½½è¿‡ // javaseLoader é»˜è®¤å°±æ˜¯ java.lang.ClassLoader.getSystemClassLoader().getParent() ClassLoader javaseLoader = getJavaseClassLoader(); boolean tryLoadingFromJavaseLoader; // åˆ¤æ–­æ˜¯å¦åº”è¯¥ç”¨ javaseLoader åŠ è½½ // ... // é€šè¿‡ javaseLoader åŠ è½½ if (tryLoadingFromJavaseLoader) { try { clazz = javaseLoader.loadClass(name); if (clazz != null) { // ... return clazz; } } catch (ClassNotFoundException e) { } } boolean delegateLoad = delegate || filter(name, true); // (1) Delegate to our parent if requested if (delegateLoad) { try { clazz = Class.forName(name, false, parent); if (clazz != null) { // ... return clazz; } } catch (ClassNotFoundException e) { // Ignore } } // (2) Search local repositories try { clazz = findClass(name); if (clazz != null) { // ... return clazz; } } catch (ClassNotFoundException e) { } // (3) Delegate to parent unconditionally if (!delegateLoad) { try { clazz = Class.forName(name, false, parent); if (clazz != null) { // ... return clazz; } } catch (ClassNotFoundException e) { } } throw new ClassNotFoundException(name); } protected boolean filter(String name, boolean isClassName) { // ... if (name.startsWith(&quot;javax&quot;)) { /* 5 == length(&quot;javax&quot;) */ if (name.length() == 5) { return false; } ch = name.charAt(5); if (isClassName &amp;&amp; ch == '.') { /* 6 == length(&quot;javax.&quot;) */ if (name.startsWith(&quot;servlet.jsp.jstl.&quot;, 6)) { return false; } if (name.startsWith(&quot;el.&quot;, 6) || name.startsWith(&quot;servlet.&quot;, 6) || name.startsWith(&quot;websocket.&quot;, 6) || name.startsWith(&quot;security.auth.message.&quot;, 6)) { return true; } } // ... } // ... }} Tomcat ClassLoader çš„å±‚æ¬¡ç»“æ„ å›¾ç‰‡æ¥æºäºç½‘ç»œ å…¶ä»–åŠ¨æ€è¯­è¨€ï¼Œä¾‹å¦‚ groovy.lang.GroovyClassLoaderä¾èµ–å†²çªéš”ç¦» https://www.zhihu.com/question/46719811/answer/1739289578 ã€‚OSGI æ¨¡å—åŒ–ï¼Œåæ¥ Java æ ‡å‡†ä¹Ÿå¼•å…¥äº†çš„æ¨¡å—åŒ–ã€‚çƒ­åŠ è½½ä¹Ÿå¯ä»¥ç”¨å¤šä¸ª ClassLoader æ¥å¤„ç†ï¼ˆIDEA é‡æ–°åŠ è½½ç±»ï¼Œä¸æ˜¯é€šè¿‡ ClassLoader å®ç°çš„ï¼‰ã€‚ ClassLoader é—®é¢˜æ’æŸ¥æ€è·¯åœ¨é‡åˆ° ClassLoader ç›¸å…³é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥è¯•è¯•å¦‚ä¸‹çš„æ€è·¯ï¼ˆä¸€èˆ¬åœ¨æœ‰å¤šä¸ª ClassLoader çš„æ—¶å€™ï¼‰ object.getClass().getClassLoader() / clazz.getClassLoader() æŸ¥çœ‹æŸä¸ªç±»çš„ ClassLoaderï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸ Thread.currentThread().getContextClassLoader() è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ ClassLoaderï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸ åœ¨é‡åˆ°ç±»åŠ è½½ç›¸å…³é”™è¯¯ï¼Œè¦èƒ½æƒ³åˆ°å¯èƒ½æ˜¯ ClassLoader ä¸å¯¹ åœ¨ä½¿ç”¨æ¡†æ¶çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°ç±»åŠ è½½ç›¸å…³é”™è¯¯ï¼Œè¦æƒ³åˆ°å¯èƒ½æ˜¯ ContextClassLoader ä¸å¯¹ object.getClass().getProtectionDomain().getCodeSource() / clazz.getProtectionDomain().getCodeSource() å¯ä»¥æŸ¥çœ‹æŸä¸ªç±»åŠ è½½çš„è·¯å¾„ï¼ˆå¦‚æœä¸¤ä¸ª Jar åŒ…éƒ½æœ‰ç›¸åŒçš„ç±»ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆæ˜¯åŠ è½½äº†å“ªä¸ª Jar åŒ…çš„ç±»ï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸ èƒ½é€šè¿‡ arthas ç±»å’Œç±»åŠ è½½ç›¸å…³çš„å‘½ä»¤ï¼ˆscï¼Œclassloaderï¼Œjad ç­‰ï¼‰æ¥æ’æŸ¥é—®é¢˜ åœ¨ä¿®æ”¹ contextClassLoader çš„æ—¶å€™ï¼Œè¦æ³¨æ„æ¢å¤ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç  12345678ClassLoader classLoader;ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();try { Thread.currentThread().setContextClassLoader(classLoader); // ...} finally { Thread.currentThread().setContextClassLoader(contextClassLoader);} è¡¥å……ï¼šoop klass æ¨¡å‹ä¸Šé¢æåˆ°ï¼Œåœ¨ hotspot ä»£ç é‡Œé¢ Klass æ˜¯ç±»çš„åº•å±‚å®ç°ï¼Œç±»åŠ è½½æœ€ç»ˆçš„ç»“æœå°±æ˜¯åˆ›å»ºä¸€ä¸ª Klass å¯¹è±¡ï¼Œoop æ˜¯æè¿°å¯¹è±¡å„ç§ä¿¡æ¯çš„æŒ‡é’ˆï¼Œoop klass æ¨¡å‹æ˜¯ JVMï¼ˆhotspotï¼‰å†…éå¸¸æ ¸å¿ƒçš„æ¨¡å‹ã€‚ hotspot/src/share/vm/oops/klass.hppklass.hpp12345678// A Klass provides:// 1: language level class object (method dictionary etc.)// 2: provide vm dispatch behavior for the object// Both functions are combined into one C++ class.// ...class Klass : public Metadata { // ...} å›¾ç‰‡æ¥æºäºç½‘ç»œ åœ¨ C++å±‚é¢æœ‰å¤šä¸ªä¸åŒçš„ç±»æ¥æè¿°è¿™ä¸ªä½“ç³»ï¼Œoop klass æ¨¡å‹è¿™éƒ¨åˆ†å†…å®¹æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæœç´¢ã€‚ åŸºæœ¬ç±»å‹int.class å’Œ java.lang.Integer.class æ˜¯ä¸åŒçš„ï¼Œint.class == java.lang.Integer.TYPEã€‚åŸºæœ¬ç±»å‹çš„å€¼æœ¬è´¨ä¸Šæ¥è¯´ä¸æ˜¯ oopï¼ˆä¹Ÿæ²¡æœ‰ç±»å‹æŒ‡é’ˆï¼‰ï¼Œæ‰€ä»¥ int.class æ›´åƒæ˜¯ JVM ç±»å‹ç³»ç»Ÿçš„ä¸€ä¸ªç‰¹ä¾‹ï¼ˆcreate_basic_type_mirror ä»åå­—ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼‰ï¼Œè¿™äº›ç±»å‹ä¹Ÿæ˜¯åœ¨ JVM åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¿›è¡ŒåŠ è½½çš„ï¼ˆSystemDictionary::initialize_preloaded_classesï¼‰ã€‚ hotspot/src/share/vm/memory/universe.cppuniverse.cpp12345678910111213141516171819202122232425262728293031void Universe::initialize_basic_type_mirrors(TRAPS) { assert(_int_mirror==NULL, &quot;basic type mirrors already initialized&quot;); _int_mirror = java_lang_Class::create_basic_type_mirror(&quot;int&quot;, T_INT, CHECK); _float_mirror = java_lang_Class::create_basic_type_mirror(&quot;float&quot;, T_FLOAT, CHECK); _double_mirror = java_lang_Class::create_basic_type_mirror(&quot;double&quot;, T_DOUBLE, CHECK); _byte_mirror = java_lang_Class::create_basic_type_mirror(&quot;byte&quot;, T_BYTE, CHECK); _bool_mirror = java_lang_Class::create_basic_type_mirror(&quot;boolean&quot;,T_BOOLEAN, CHECK); _char_mirror = java_lang_Class::create_basic_type_mirror(&quot;char&quot;, T_CHAR, CHECK); _long_mirror = java_lang_Class::create_basic_type_mirror(&quot;long&quot;, T_LONG, CHECK); _short_mirror = java_lang_Class::create_basic_type_mirror(&quot;short&quot;, T_SHORT, CHECK); _void_mirror = java_lang_Class::create_basic_type_mirror(&quot;void&quot;, T_VOID, CHECK); _mirrors[T_INT] = _int_mirror; _mirrors[T_FLOAT] = _float_mirror; _mirrors[T_DOUBLE] = _double_mirror; _mirrors[T_BYTE] = _byte_mirror; _mirrors[T_BOOLEAN] = _bool_mirror; _mirrors[T_CHAR] = _char_mirror; _mirrors[T_LONG] = _long_mirror; _mirrors[T_SHORT] = _short_mirror; _mirrors[T_VOID] = _void_mirror;} æ•°ç»„ç±»å‹éœ€è¦æ³¨æ„çš„æ˜¯æ•°ç»„æ˜¯ JVM å†…éƒ¨ç›´æ¥ç”Ÿæˆçš„ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼ˆArrayKlassï¼‰ã€‚åœ¨å®šä¹‰ SomeClass[] array = new SomeClass[1] æ—¶å¹¶ä¸ä¼šå¯¼è‡´ SomeClass ç±»çš„åˆå§‹åŒ–ã€‚æ•°ç»„ä¹Ÿæ˜¯ JVM ç±»å‹ç³»ç»Ÿçš„ç‰¹ä¾‹ã€‚ è¡¥å……ï¼šJava æ ‡å‡†æ¨¡å—åŒ–ï¼ˆJava 9+ï¼‰åœ¨å¼•å…¥æ¨¡å—åŒ–ä¹‹åï¼Œæ•´ä¸ªç±»åŠ è½½æœºåˆ¶ä¼šæœ‰ä¸€äº›å˜åŒ–ï¼Œåé¢ä¼šå•ç‹¬å†™ä¸€éæ–‡ç« æ¥è®²è§£ã€‚ å‚è€ƒhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.htmlhttps://hg.openjdk.java.net/jdk8https://docs.oracle.com/javase/8/docs/technotes/tools/findingclasses.htmlhttps://docs.oracle.com/javase/8/docs/technotes/guides/security/spec/security-spec.doc5.htmlã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹https://www.cnblogs.com/mazhimazhi/","link":"/2021/09/java-classloader/"}],"tags":[{"name":"hexo","slug":"hexo","link":"/tags/hexo/"},{"name":"icarus","slug":"icarus","link":"/tags/icarus/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"ubuntu","slug":"ubuntu","link":"/tags/ubuntu/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"matplotlib","slug":"matplotlib","link":"/tags/matplotlib/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"jvm","slug":"jvm","link":"/tags/jvm/"},{"name":"classloader","slug":"classloader","link":"/tags/classloader/"}],"categories":[{"name":"hexo","slug":"hexo","link":"/categories/hexo/"},{"name":"icarus","slug":"hexo/icarus","link":"/categories/hexo/icarus/"},{"name":"linux","slug":"linux","link":"/categories/linux/"},{"name":"python","slug":"python","link":"/categories/python/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"ubuntu","slug":"linux/ubuntu","link":"/categories/linux/ubuntu/"},{"name":"matplotlib","slug":"python/matplotlib","link":"/categories/python/matplotlib/"}]}